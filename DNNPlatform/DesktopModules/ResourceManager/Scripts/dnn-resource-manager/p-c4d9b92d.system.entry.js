System.register(["./p-c9ec67c1.system.js","./p-df562e61.system.js"],(function(e){"use strict";var t,i,o,r,n;return{setters:[function(e){t=e.r;i=e.c;o=e.h;r=e.H},function(e){n=e.g}],execute:function(){var a;(function(e){e[e["nw"]=0]="nw";e[e["ne"]=1]="ne";e[e["se"]=2]="se";e[e["sw"]=3]="sw"})(a||(a={}));var s=":host{display:block}canvas{display:none}.view{visibility:hidden;opacity:0;height:0;overflow:hidden;-webkit-transition:all 300ms ease-in-out;transition:all 300ms ease-in-out}.view.visible{visibility:visible;opacity:1;height:initial;overflow:visible}.view .cropper{position:relative;width:100%}.view .cropper img{width:100%;display:block;margin:0 auto}.view .cropper .backdrop{-webkit-backdrop-filter:saturate(0.5);backdrop-filter:saturate(0.5);-webkit-backdrop-filter:brightness(0.5);backdrop-filter:brightness(0.5);position:absolute;left:0;top:0;width:100%;height:100%}.view .cropper .crop{position:absolute;top:0;left:0;width:100%;height:100%;outline:2px dashed white;-webkit-box-shadow:black 0 0 0px 2px;box-shadow:black 0 0 0px 2px;-webkit-backdrop-filter:saturate(2);backdrop-filter:saturate(2);-webkit-backdrop-filter:brightness(2);backdrop-filter:brightness(2);cursor:move}.view .cropper .crop>div{width:20px;height:20px;background-color:white;border:2px solid rgba(0, 0, 0, 0.5);position:absolute}.view .cropper .crop>div.nw,.view .cropper .crop>div.ne{top:-17px}.view .cropper .crop>div.ne,.view .cropper .crop>div.se{right:-17px}.view .cropper .crop>div.se,.view .cropper .crop>div.sw{bottom:-17px}.view .cropper .crop>div.sw,.view .cropper .crop>div.nw{left:-17px}.view .cropper .crop>div.nw,.view .cropper .crop>div.se{cursor:nwse-resize}.view .cropper .crop>div.ne,.view .cropper .crop>div.sw{cursor:nesw-resize}dnn-modal{--max-width:512px}";var h=e("dnn_image_cropper",function(){function e(e){var o=this;t(this,e);this.imageCropChanged=i(this,"imageCropChanged",7);this.width=600;this.height=600;this.resx={capture:"Capture",dragAndDropFile:"Drag and drop an image",or:"or",takePicture:"Take a picture",uploadFile:"Upload an image",imageTooSmall:"The image you are attempting to upload does not meet the minimum size requirement of {width} pixels by {height} pixels. Please upload a larger image.",modalCloseText:"Close"};this.quality=.8;this.preventUndersized=false;this.handleCropMouseDown=function(e){e.stopPropagation();e.preventDefault();var t=e.target;var i=t.classList[0];document.addEventListener("mouseup",o.handleImageCropFinished,false);document.addEventListener("touchend",o.handleImageCropFinished,false);switch(i){case"crop":document.addEventListener("mousemove",o.handleCropDrag,false);document.addEventListener("touchmove",o.handleCropDrag,false);document.addEventListener("mouseup",(function(){return document.removeEventListener("mousemove",o.handleCropDrag)}));document.addEventListener("touchend",(function(){return document.removeEventListener("touchmove",o.handleCropDrag)}));break;case"nw":document.addEventListener("mousemove",o.handleNwMouseMove,false);document.addEventListener("touchmove",o.handleNwMouseMove,false);document.addEventListener("mouseup",(function(){return document.removeEventListener("mousemove",o.handleNwMouseMove)}));document.addEventListener("touchend",(function(){return document.removeEventListener("touchmove",o.handleNwMouseMove)}));break;case"ne":document.addEventListener("mousemove",o.handleNeMouseMove,false);document.addEventListener("touchmove",o.handleNeMouseMove,false);document.addEventListener("mouseup",(function(){return document.removeEventListener("mousemove",o.handleNeMouseMove)}));document.addEventListener("touchend",(function(){return document.removeEventListener("touchmove",o.handleNeMouseMove)}));break;case"se":document.addEventListener("mousemove",o.handleSeMouseMove,false);document.addEventListener("touchmove",o.handleSeMouseMove,false);document.addEventListener("mouseup",(function(){return document.removeEventListener("mousemove",o.handleSeMouseMove)}));document.addEventListener("touchend",(function(){return document.removeEventListener("touchmove",o.handleSeMouseMove)}));break;case"sw":document.addEventListener("mousemove",o.handleSwMouseMove,false);document.addEventListener("touchmove",o.handleSwMouseMove,false);document.addEventListener("mouseup",(function(){return document.removeEventListener("mousemove",o.handleSwMouseMove)}));document.addEventListener("touchend",(function(){return document.removeEventListener("touchmove",o.handleSwMouseMove)}));break}};this.handleImageCropFinished=function(e){o.emitImage();document.removeEventListener("mouseup",o.handleImageCropFinished);o.previousTouch=undefined};this.handleNwMouseMove=function(e){o.handleCornerDrag(e,a.nw)};this.handleNeMouseMove=function(e){o.handleCornerDrag(e,a.ne)};this.handleSeMouseMove=function(e){o.handleCornerDrag(e,a.se)};this.handleSwMouseMove=function(e){o.handleCornerDrag(e,a.sw)};this.handleCornerDrag=function(e,t){if(!o.isMouseStillInTarget(e)){return}var i=o.getCornerLeftTop(t),r=i.left,s=i.top;var h=0;var c=0;var d="horizontal";var u=o.width/o.height;var p=o.crop.getBoundingClientRect();var l=o.image.getBoundingClientRect();var v=n(e,o.previousTouch),m=v.movementX,g=v.movementY;if(Math.abs(m)<Math.abs(g)){d="vertical"}if(d=="horizontal"){switch(t){case a.nw:case a.sw:h=p.width-m;c=h/u;break;case a.ne:case a.se:h=p.width+m;c=h/u;break}}else{switch(t){case a.nw:case a.ne:c=p.height-g;h=c*u;break;case a.se:case a.sw:c=p.height+g;h=c*u;break}}switch(t){case a.ne:case a.nw:var f=p.height-c;s=o.crop.offsetTop+f}switch(t){case a.nw:case a.sw:var w=p.width-h;r=o.crop.offsetLeft+w;if(r<0)r=0;if(r>l.width)r=l.width;if(s<0)s=0;if(s>l.height)s=l.height;if(r+h>l.width)h=l.width-r;if(s+c>l.height)c=l.height-s;break;case a.ne:case a.se:if(s<0)s=0;if(s>l.height)s=l.height;if(r+h>l.width)h=l.width-r;if(s+c>l.height)c=l.height-s;break}if(h/c!=u){return}if(o.preventUndersized){var b=o.image.width/o.image.naturalWidth;if(h/b<o.width||c/b<o.height){return}}switch(t){case a.ne:o.crop.style.top="".concat(s,"px");o.crop.style.width="".concat(h,"px");o.crop.style.height="".concat(c,"px");break;case a.nw:o.crop.style.left="".concat(r,"px");o.crop.style.top="".concat(s,"px");o.crop.style.width="".concat(h,"px");o.crop.style.height="".concat(c,"px");break;case a.se:o.crop.style.width="".concat(h,"px");o.crop.style.height="".concat(c,"px");break;case a.sw:o.crop.style.left="".concat(r,"px");o.crop.style.width="".concat(h,"px");o.crop.style.height="".concat(c,"px");break}};this.handleCropDrag=function(e){if(!o.isMouseStillInTarget(e)){return}var t=n(e,o.previousTouch),i=t.movementX,r=t.movementY;var a=o.crop.offsetLeft+i;var s=o.crop.offsetTop+r;var h=o.image.getBoundingClientRect();var c=o.crop.getBoundingClientRect();if(a<0){a=0}if(s<0){s=0}if(a+c.width>h.width){a=o.crop.offsetLeft}if(s+c.height>h.height){s=o.crop.offsetTop}o.crop.style.left=a+"px";o.crop.style.top=s+"px"}}e.prototype.componentDidLoad=function(){var e=this;requestAnimationFrame((function(){e.setView("noPictureView")}))};e.prototype.setView=function(e){var t=this.host.shadowRoot.querySelectorAll(".view");t.forEach((function(e){return e.classList.remove("visible")}));switch(e){case"noPictureView":this.noPictureView.classList.add("visible");break;case"hasPictureView":this.hasPictureView.classList.add("visible");break}this.view=e};e.prototype.initCrop=function(){var e=this.width/this.height;var t=this.image.getBoundingClientRect();var i=t.width/t.height;if(e>i){var o=t.width/e;var r=t.height-o;this.crop.style.top=Math.round(r/2).toString()+"px";this.crop.style.height=Math.round(o).toString()+"px"}else{var n=t.height*e;var r=t.width-n;this.crop.style.left=Math.round(r/2).toString()+"px";this.crop.style.width=Math.round(n).toString()+"px"}};e.prototype.setImage=function(){var e=this;this.image.addEventListener("load",(function(){e.initCrop();e.emitImage()}));this.image.src=this.canvas.toDataURL()};e.prototype.handleNewFile=function(e){var t=this;if(e.type.split("/")[0]!="image"){return}var i=new FileReader;i.onload=function(e){var i=new Image;i.onload=function(){t.canvas.width=i.width;t.canvas.height=i.height;if(t.preventUndersized&&(i.width<t.width||i.height<t.height)){t.imageTooSmallModal.show();return}var e=t.canvas.getContext("2d");e.drawImage(i,0,0);t.setView("hasPictureView");t.setImage()};i.src=e.target.result.toString()};i.readAsDataURL(e)};e.prototype.emitImage=function(){var e=this.crop.offsetLeft/this.image.width*this.image.naturalWidth;var t=this.crop.offsetTop/this.image.height*this.image.naturalHeight;var i=this.crop.getBoundingClientRect();var o=i.width/this.image.width*this.image.naturalWidth;var r=i.height/this.image.height*this.image.naturalHeight;if(e<0)e=0;if(e>this.image.naturalWidth)e=this.image.naturalWidth;if(t<0)t=0;if(t>this.image.naturalWidth)t=this.image.naturalWidth;if(o>this.image.naturalWidth)o=this.image.naturalWidth;if(r>this.image.naturalHeight)r=this.image.naturalHeight;var n=this.generateCroppedImage(e,t,o,r,this.width,this.height);this.imageCropChanged.emit(n)};e.prototype.generateCroppedImage=function(e,t,i,o,r,n){this.canvas.width=r;this.canvas.height=n;var a=this.canvas.getContext("2d");a.clearRect(0,0,r,n);a.drawImage(this.image,e,t,i,o,0,0,r,n);return this.canvas.toDataURL("image/jpeg",this.quality)};e.prototype.getCornerLeftTop=function(e){var t=0;var i=0;switch(e){case a.se:t=this.crop.offsetLeft;i=this.crop.offsetTop;break;case a.sw:i=this.crop.offsetTop;break}return{top:i,left:t}};e.prototype.isMouseStillInTarget=function(e){var t=false;var i;var o;var r=this.image.getBoundingClientRect();if(e instanceof MouseEvent){i=e.clientX;o=e.clientY}if(typeof TouchEvent!=="undefined"){if(e instanceof TouchEvent){var n=e.touches[0];i=n.clientX;o=n.clientY}}if(i>=r.x&&o>=r.y&&i<=r.left+r.width&&o<=r.top+r.height){t=true}var a=this.crop.querySelectorAll("div");a.forEach((function(e){var r=e.getBoundingClientRect();if(i>=r.x&&o>=r.y&&i<=r.left+r.width&&o<=r.top+r.height){t=true}}));return t};e.prototype.render=function(){var e=this;return o(r,{ref:function(t){return e.host=t}},o("canvas",{ref:function(t){return e.canvas=t}}),o("div",{class:"view",ref:function(t){return e.hasPictureView=t}},o("div",{class:"cropper"},o("img",{ref:function(t){return e.image=t}}),o("div",{class:"backdrop"}),o("div",{class:"crop",ref:function(t){return e.crop=t},onMouseDown:this.handleCropMouseDown,onTouchStart:this.handleCropMouseDown},o("div",{class:"nw"}),o("div",{class:"ne"}),o("div",{class:"se"}),o("div",{class:"sw"})))),o("div",{class:"view",ref:function(t){return e.noPictureView=t}},o("dnn-dropzone",{allowCameraMode:true,onFilesSelected:function(t){return e.handleNewFile(t.detail[0])},resx:{capture:this.resx.capture,dragAndDropFile:this.resx.dragAndDropFile,or:this.resx.or,takePicture:this.resx.takePicture,uploadFile:this.resx.uploadFile}})),o("dnn-modal",{ref:function(t){return e.imageTooSmallModal=t},"close-text":this.resx.modalCloseText},o("p",null,this.resx.imageTooSmall.replace("{width}",this.width.toString()).replace("{height}",this.height.toString()))))};return e}());h.style=s}}}));
//# sourceMappingURL=p-c4d9b92d.system.entry.js.map