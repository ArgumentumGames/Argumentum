import{r as e,c as t,h as i,H as s}from"./p-7f611392.js";import{g as o}from"./p-c15b7d5a.js";var h;(function(e){e[e["nw"]=0]="nw";e[e["ne"]=1]="ne";e[e["se"]=2]="se";e[e["sw"]=3]="sw"})(h||(h={}));const r=":host{display:block}canvas{display:none}.view{visibility:hidden;opacity:0;height:0;overflow:hidden;-webkit-transition:all 300ms ease-in-out;transition:all 300ms ease-in-out}.view.visible{visibility:visible;opacity:1;height:initial;overflow:visible}.view .cropper{position:relative;width:100%}.view .cropper img{width:100%;display:block;margin:0 auto}.view .cropper .backdrop{-webkit-backdrop-filter:saturate(0.5);backdrop-filter:saturate(0.5);-webkit-backdrop-filter:brightness(0.5);backdrop-filter:brightness(0.5);position:absolute;left:0;top:0;width:100%;height:100%}.view .cropper .crop{position:absolute;top:0;left:0;width:100%;height:100%;outline:2px dashed white;-webkit-box-shadow:black 0 0 0px 2px;box-shadow:black 0 0 0px 2px;-webkit-backdrop-filter:saturate(2);backdrop-filter:saturate(2);-webkit-backdrop-filter:brightness(2);backdrop-filter:brightness(2);cursor:move}.view .cropper .crop>div{width:20px;height:20px;background-color:white;border:2px solid rgba(0, 0, 0, 0.5);position:absolute}.view .cropper .crop>div.nw,.view .cropper .crop>div.ne{top:-17px}.view .cropper .crop>div.ne,.view .cropper .crop>div.se{right:-17px}.view .cropper .crop>div.se,.view .cropper .crop>div.sw{bottom:-17px}.view .cropper .crop>div.sw,.view .cropper .crop>div.nw{left:-17px}.view .cropper .crop>div.nw,.view .cropper .crop>div.se{cursor:nwse-resize}.view .cropper .crop>div.ne,.view .cropper .crop>div.sw{cursor:nesw-resize}dnn-modal{--max-width:512px}";const a=class{constructor(i){e(this,i);this.imageCropChanged=t(this,"imageCropChanged",7);this.width=600;this.height=600;this.resx={capture:"Capture",dragAndDropFile:"Drag and drop an image",or:"or",takePicture:"Take a picture",uploadFile:"Upload an image",imageTooSmall:"The image you are attempting to upload does not meet the minimum size requirement of {width} pixels by {height} pixels. Please upload a larger image.",modalCloseText:"Close"};this.quality=.8;this.preventUndersized=false;this.handleCropMouseDown=e=>{e.stopPropagation();e.preventDefault();const t=e.target;const i=t.classList[0];document.addEventListener("mouseup",this.handleImageCropFinished,false);document.addEventListener("touchend",this.handleImageCropFinished,false);switch(i){case"crop":document.addEventListener("mousemove",this.handleCropDrag,false);document.addEventListener("touchmove",this.handleCropDrag,false);document.addEventListener("mouseup",(()=>document.removeEventListener("mousemove",this.handleCropDrag)));document.addEventListener("touchend",(()=>document.removeEventListener("touchmove",this.handleCropDrag)));break;case"nw":document.addEventListener("mousemove",this.handleNwMouseMove,false);document.addEventListener("touchmove",this.handleNwMouseMove,false);document.addEventListener("mouseup",(()=>document.removeEventListener("mousemove",this.handleNwMouseMove)));document.addEventListener("touchend",(()=>document.removeEventListener("touchmove",this.handleNwMouseMove)));break;case"ne":document.addEventListener("mousemove",this.handleNeMouseMove,false);document.addEventListener("touchmove",this.handleNeMouseMove,false);document.addEventListener("mouseup",(()=>document.removeEventListener("mousemove",this.handleNeMouseMove)));document.addEventListener("touchend",(()=>document.removeEventListener("touchmove",this.handleNeMouseMove)));break;case"se":document.addEventListener("mousemove",this.handleSeMouseMove,false);document.addEventListener("touchmove",this.handleSeMouseMove,false);document.addEventListener("mouseup",(()=>document.removeEventListener("mousemove",this.handleSeMouseMove)));document.addEventListener("touchend",(()=>document.removeEventListener("touchmove",this.handleSeMouseMove)));break;case"sw":document.addEventListener("mousemove",this.handleSwMouseMove,false);document.addEventListener("touchmove",this.handleSwMouseMove,false);document.addEventListener("mouseup",(()=>document.removeEventListener("mousemove",this.handleSwMouseMove)));document.addEventListener("touchend",(()=>document.removeEventListener("touchmove",this.handleSwMouseMove)));break}};this.handleImageCropFinished=e=>{this.emitImage();document.removeEventListener("mouseup",this.handleImageCropFinished);this.previousTouch=undefined};this.handleNwMouseMove=e=>{this.handleCornerDrag(e,h.nw)};this.handleNeMouseMove=e=>{this.handleCornerDrag(e,h.ne)};this.handleSeMouseMove=e=>{this.handleCornerDrag(e,h.se)};this.handleSwMouseMove=e=>{this.handleCornerDrag(e,h.sw)};this.handleCornerDrag=(e,t)=>{if(!this.isMouseStillInTarget(e)){return}let{left:i,top:s}=this.getCornerLeftTop(t);let r=0;let a=0;let c="horizontal";const n=this.width/this.height;const p=this.crop.getBoundingClientRect();const d=this.image.getBoundingClientRect();let{movementX:u,movementY:m}=o(e,this.previousTouch);if(Math.abs(u)<Math.abs(m)){c="vertical"}if(c=="horizontal"){switch(t){case h.nw:case h.sw:r=p.width-u;a=r/n;break;case h.ne:case h.se:r=p.width+u;a=r/n;break}}else{switch(t){case h.nw:case h.ne:a=p.height-m;r=a*n;break;case h.se:case h.sw:a=p.height+m;r=a*n;break}}switch(t){case h.ne:case h.nw:const e=p.height-a;s=this.crop.offsetTop+e}switch(t){case h.nw:case h.sw:const e=p.width-r;i=this.crop.offsetLeft+e;if(i<0)i=0;if(i>d.width)i=d.width;if(s<0)s=0;if(s>d.height)s=d.height;if(i+r>d.width)r=d.width-i;if(s+a>d.height)a=d.height-s;break;case h.ne:case h.se:if(s<0)s=0;if(s>d.height)s=d.height;if(i+r>d.width)r=d.width-i;if(s+a>d.height)a=d.height-s;break}if(r/a!=n){return}if(this.preventUndersized){const e=this.image.width/this.image.naturalWidth;if(r/e<this.width||a/e<this.height){return}}switch(t){case h.ne:this.crop.style.top=`${s}px`;this.crop.style.width=`${r}px`;this.crop.style.height=`${a}px`;break;case h.nw:this.crop.style.left=`${i}px`;this.crop.style.top=`${s}px`;this.crop.style.width=`${r}px`;this.crop.style.height=`${a}px`;break;case h.se:this.crop.style.width=`${r}px`;this.crop.style.height=`${a}px`;break;case h.sw:this.crop.style.left=`${i}px`;this.crop.style.width=`${r}px`;this.crop.style.height=`${a}px`;break}};this.handleCropDrag=e=>{if(!this.isMouseStillInTarget(e)){return}let{movementX:t,movementY:i}=o(e,this.previousTouch);let s=this.crop.offsetLeft+t;let h=this.crop.offsetTop+i;var r=this.image.getBoundingClientRect();var a=this.crop.getBoundingClientRect();if(s<0){s=0}if(h<0){h=0}if(s+a.width>r.width){s=this.crop.offsetLeft}if(h+a.height>r.height){h=this.crop.offsetTop}this.crop.style.left=s+"px";this.crop.style.top=h+"px"}}componentDidLoad(){requestAnimationFrame((()=>{this.setView("noPictureView")}))}setView(e){const t=this.host.shadowRoot.querySelectorAll(".view");t.forEach((e=>e.classList.remove("visible")));switch(e){case"noPictureView":this.noPictureView.classList.add("visible");break;case"hasPictureView":this.hasPictureView.classList.add("visible");break}this.view=e}initCrop(){var e=this.width/this.height;var t=this.image.getBoundingClientRect();var i=t.width/t.height;if(e>i){var s=t.width/e;var o=t.height-s;this.crop.style.top=Math.round(o/2).toString()+"px";this.crop.style.height=Math.round(s).toString()+"px"}else{var h=t.height*e;var o=t.width-h;this.crop.style.left=Math.round(o/2).toString()+"px";this.crop.style.width=Math.round(h).toString()+"px"}}setImage(){this.image.addEventListener("load",(()=>{this.initCrop();this.emitImage()}));this.image.src=this.canvas.toDataURL()}handleNewFile(e){if(e.type.split("/")[0]!="image"){return}var t=new FileReader;t.onload=e=>{var t=new Image;t.onload=()=>{this.canvas.width=t.width;this.canvas.height=t.height;if(this.preventUndersized&&(t.width<this.width||t.height<this.height)){this.imageTooSmallModal.show();return}var e=this.canvas.getContext("2d");e.drawImage(t,0,0);this.setView("hasPictureView");this.setImage()};t.src=e.target.result.toString()};t.readAsDataURL(e)}emitImage(){var e=this.crop.offsetLeft/this.image.width*this.image.naturalWidth;var t=this.crop.offsetTop/this.image.height*this.image.naturalHeight;var i=this.crop.getBoundingClientRect();var s=i.width/this.image.width*this.image.naturalWidth;var o=i.height/this.image.height*this.image.naturalHeight;if(e<0)e=0;if(e>this.image.naturalWidth)e=this.image.naturalWidth;if(t<0)t=0;if(t>this.image.naturalWidth)t=this.image.naturalWidth;if(s>this.image.naturalWidth)s=this.image.naturalWidth;if(o>this.image.naturalHeight)o=this.image.naturalHeight;var h=this.generateCroppedImage(e,t,s,o,this.width,this.height);this.imageCropChanged.emit(h)}generateCroppedImage(e,t,i,s,o,h){this.canvas.width=o;this.canvas.height=h;const r=this.canvas.getContext("2d");r.clearRect(0,0,o,h);r.drawImage(this.image,e,t,i,s,0,0,o,h);return this.canvas.toDataURL("image/jpeg",this.quality)}getCornerLeftTop(e){let t=0;let i=0;switch(e){case h.se:t=this.crop.offsetLeft;i=this.crop.offsetTop;break;case h.sw:i=this.crop.offsetTop;break}return{top:i,left:t}}isMouseStillInTarget(e){var t=false;let i;let s;const o=this.image.getBoundingClientRect();if(e instanceof MouseEvent){i=e.clientX;s=e.clientY}if(typeof TouchEvent!=="undefined"){if(e instanceof TouchEvent){var h=e.touches[0];i=h.clientX;s=h.clientY}}if(i>=o.x&&s>=o.y&&i<=o.left+o.width&&s<=o.top+o.height){t=true}var r=this.crop.querySelectorAll("div");r.forEach((e=>{var o=e.getBoundingClientRect();if(i>=o.x&&s>=o.y&&i<=o.left+o.width&&s<=o.top+o.height){t=true}}));return t}render(){return i(s,{ref:e=>this.host=e},i("canvas",{ref:e=>this.canvas=e}),i("div",{class:"view",ref:e=>this.hasPictureView=e},i("div",{class:"cropper"},i("img",{ref:e=>this.image=e}),i("div",{class:"backdrop"}),i("div",{class:"crop",ref:e=>this.crop=e,onMouseDown:this.handleCropMouseDown,onTouchStart:this.handleCropMouseDown},i("div",{class:"nw"}),i("div",{class:"ne"}),i("div",{class:"se"}),i("div",{class:"sw"})))),i("div",{class:"view",ref:e=>this.noPictureView=e},i("dnn-dropzone",{allowCameraMode:true,onFilesSelected:e=>this.handleNewFile(e.detail[0]),resx:{capture:this.resx.capture,dragAndDropFile:this.resx.dragAndDropFile,or:this.resx.or,takePicture:this.resx.takePicture,uploadFile:this.resx.uploadFile}})),i("dnn-modal",{ref:e=>this.imageTooSmallModal=e,"close-text":this.resx.modalCloseText},i("p",null,this.resx.imageTooSmall.replace("{width}",this.width.toString()).replace("{height}",this.height.toString()))))}};a.style=r;export{a as dnn_image_cropper};
//# sourceMappingURL=p-b6a09d1d.entry.js.map