!function(){angular.module("SourceEditor",["EavConfiguration","EavServices","SxcServices","SxcTemplates","pascalprecht.translate","ui.ace"]).config(["$translatePartialLoaderProvider",function(e){e.addPart("source-editor-snippets")}])}(),angular.module("SourceEditor").component("devFiles",{templateUrl:"source-editor/dev-files.html",controller:["appAssetsSvc","appId",function(e,n){var t=angular.extend(this,{show:!1,svc:e(n),toggle:function(){t.show=!t.show,t.assets||(t.assets=t.svc.liveList())},editFile:function(e){window.open(t.assembleUrl(e)),t.toggle()},assembleUrl:function(e){var n=window.location.href,t=JSON.stringify([{Path:e}]);return n.replace(new RegExp("items=.*?%5d","i"),"items="+encodeURI(t))},addFile:function(){var e=prompt("please enter full file name");e&&t.svc.create(e)}})}],controllerAs:"vm",bindings:{fileName:"<",type:"<"}}),function(){function e(e,n,t,i,r,s,o,a,l,p,c,u,d){function v(){u(function(){f.save(!1)})}var g=s[0];p.refresh();var f=this;f.debug=d;var m=e(void 0!==g.EntityId?g.EntityId:g.Path);f.view={},f.tempCodeBecauseOfBug="",f.editor=null,m.get().then(function(e){f.view=e.data,m.initSnippets(f.view)}),m.initSnippets=function(e){f.snipSvc=n(e,ace),f.snipSvc.getSnippets().then(function(e){f.snippets=e,f.registerSnippets()})},f.close=function(){confirm(p.instant("Message.ExitOk"))&&window.close()},l.$on("modal.closing",function(e){e.preventDefault()}),a.addEventListener("beforeunload",function(e){var n=p.instant("Message.ExitOk");return(e||window.event).returnValue=n,n}),f.save=function(e){var n=e?f.close:function(){},t=f.editor.getValue(),i=angular.copy(f.view);i.Code!==t&&(i.Code=t),c(m.save(i)).then(n)},v(),f.registerSnippets=function(){f.snipSvc&&f.editor&&f.snipSvc.registerInEditor()},f.aceLoaded=function(e){f.editor=e,f.registerSnippets()}}e.$inject=["sourceSvc","snippetSvc","appAssetsSvc","appId","sxcDialogs","items","$uibModalInstance","$window","$scope","$translate","saveToastr","ctrlS","debugState"],angular.module("SourceEditor").component("editor",{templateUrl:"source-editor/editor.html",controller:e,controllerAs:"vm"})}(),angular.module("SourceEditor").component("snippetsLinks",{templateUrl:"source-editor/snippets-links.html",controller:function(){},controllerAs:"vm",bindings:{links:"<"}}),angular.module("SourceEditor").component("snippets",{templateUrl:"source-editor/snippets.html",controller:function(){var e=this;e.snippetSet="Content",e.addSnippet=function(n){var t=ace.require("ace/snippets").snippetManager;t.insertSnippet(e.editor,n),e.editor.focus()},e.$onInit=function(){console.log("component snip loading"),console.log("def set"+e.snippetSet)},e.$onChanges=function(){console.log("def set"+e.snippetSet)}},controllerAs:"vm",bindings:{snippets:"<",editor:"<"}}),angular.module("SourceEditor").factory("snippetSvc",["$http","eavConfig","svcCreator","$translate","contentTypeFieldSvc","$q",function(e,n,t,i,r,s){function o(){var e={inputTypeSnippets:{},extractInputTypeSnippets:function(n,t){for(var i=[],r=0;r<n.length;r++){var s=n[r],o="\\"===s.set[0];o?(s.set=s.set.substr(1),i.push(s)):t.push(s)}e.inputTypeSnippets=e.catalogInputTypeSnippets(i)},catalogInputTypeSnippets:function(e){for(var n={},t=0;t<e.length;t++)void 0===n[e[t].subset]&&(n[e[t].subset]=[]),n[e[t].subset].push(e[t]);return n},attachSnippets:function(n,t,i,r,s){var o=e.inputTypeSnippets[r];if(r.indexOf("-")){var a=r.substr(0,r.indexOf("-"));if(a){var l=e.inputTypeSnippets[a];l&&(o=o?o.concat(l):l)}}if(o){void 0===n[i].more&&(n[i].more=[]);for(var p=n[i].more,c=0;c<o.length;c++)try{p[i+"-"+o[c].name]=angular.extend({},s,{key:i+" - "+o[c].name,label:o[c].name,snip:e.localizeGenericSnippet(o[c].content,t,i),collapse:!0})}finally{}}},localizeGenericSnippet:function(e,n,t){return e=e.replace(/(\$\{[0-9]+\:)var(\})/gi,"$1"+n+"$2").replace(/(\$\{[0-9]+\:)prop(\})/gi,"$1"+t+"$2")}};return e}return function(n,t){var a={cachedSnippets:{},inputTypes:o(),loaded:!1,list:[],tree:null,ace:t,getSnippets:function(){return a.loaded?s(function(e,n){e(a.cachedSnippets)}):a.loadTable().then(function(e){var n=a.filterAwayNotNeededSnippetsList(e.data.snippets);a.inputTypes.extractInputTypeSnippets(n,a.list);var t=a.initSnippetsWithConfig(a.list);for(var i in t)a.cachedSnippets[i]=t[i];return a.loaded=!0,a.cachedSnippets})},initSnippetsWithConfig:function(e){return e=a.tree=a.makeTree(e),e.Content=angular.extend({},e.Content,{Fields:{},PresentationFields:{}}),n.TypeContent&&a.loadContentType(e.Content.Fields,n.TypeContent,"Content"),n.TypeContentPresentation&&a.loadContentType(e.Content.PresentationFields,n.TypeContentPresentation,"Content.Presentation"),n.HasList?(e.List=angular.extend({},e.List,{Fields:{},PresentationFields:{}}),n.TypeList&&a.loadContentType(e.List.Fields,n.TypeList,"ListContent"),n.TypeListPresentation&&a.loadContentType(e.List.PresentationFields,n.TypeListPresentation,"ListContent.Presentation")):delete e.List,n.HasApp&&(e.App.Resources={},e.App.Settings={},a.loadContentType(e.App.Resources,"App-Resources","App.Resources"),a.loadContentType(e.App.Settings,"App-Settings","App.Settings")),a.cachedSnippets=e,e},loadTable:function(){return e.get("../sxc-develop/snippets.json.js")},makeTree:function(e){for(var n={},t=0;t<e.length;t++){var i=e[t];void 0===n[i.set]&&(n[i.set]={}),void 0===n[i.set][i.subset]&&(n[i.set][i.subset]=[]);var r={key:i.name,label:a.label(i.set,i.subset,i.name),snip:i.content,help:i.help||a.help(i.set,i.subset,i.name),links:a.linksList(i.links)};n[i.set][i.subset].push(r)}return n},linksList:function(e){if(!e)return null;for(var n=[],t=e.split("\n"),i=0;i<t.length;i++){var r=t[i].split(":");3===r.length&&n.push({name:r[0].trim(),url:r[1].trim()+":"+r[2].trim()})}return 0===n.length?null:n},help:function(e,n,t){var r=a.getHelpKey(e,n,t,".Help"),s=i.instant(r);return s===r&&(s=""),s},label:function(e,n,t){var r=a.getHelpKey(e,n,t,".Key"),s=i.instant(r);return s===r&&(s=t),s},getHelpKey:function(e,n,t,i){return"SourceEditorSnippets."+e+"."+n+"."+t+i},filterAwayNotNeededSnippetsList:function(e){for(var n=[],t=0;t<e.length;t++){var i=e[t],r=a.keyPrefixes.indexOf(i.set[0]);-1!==r&&r!==a.keyPrefixIndex||(r===a.keyPrefixIndex&&(i.set=i.set.substr(1)),n.push(i))}return n},keyPrefixes:["@","["],keyPrefixIndex:n.Type.indexOf("Razor")>-1?0:1,loadContentType:function(e,t,s){r(n.AppId,{StaticName:t}).getFields().then(function(n){angular.forEach(n.data,function(n){var t=n.StaticName;e[t]={key:t,label:t,snip:a.valuePlaceholder(s,t),help:n.Metadata.merged.Notes||" ("+n.Type.toLowerCase()+") "};var i=angular.copy(e[t]);a.inputTypes.attachSnippets(e,s,t,n.InputType,i)});var t=["EntityId","EntityTitle","EntityGuid","EntityType","IsPublished","Modified"];if(n.data.length)for(var r=0;r<t.length;r++)e[t[r]]={key:t[r],label:t[r],snip:a.valuePlaceholder(s,t[r]),help:i.instant("SourceEditorSnippets.StandardFields."+t[r]+".Help")}})},valuePlaceholder:function(e,t){return n.Type.indexOf("Razor")>-1?"@"+e+"."+t:"["+e.replace(".",":")+":"+t+"]"},registerInEditor:function(){if(null===a.list)throw"can't register snippets because list is not loaded";var e=t.require("ace/snippets").snippetManager;e.register(a.list)}};return a}}]),angular.module("SourceEditor").factory("sourceSvc",["$http",function(e){return function(n){var t=isNaN(n)?{path:n}:{templateId:n},i={get:function(){return e.get("app-sys/appassets/asset",{params:t}).then(function(e){var n=e.data;if("auto"===n.Type.toLowerCase())switch(n.Extension.toLowerCase()){case".cs":case".cshtml":n.Type="Razor";break;case".html":case".css":case".js":n.Type="Token"}return e})},save:function(n){return e.post("app-sys/appassets/asset",n,{params:t})}};return i}}]),function(){angular.module("SourceEditor").filter("toArray",function(){return function(e,n){return angular.isObject(e)?n===!1?Object.keys(e).map(function(n){return e[n]}):Object.keys(e).map(function(n){var t=e[n];return angular.isObject(t)?Object.defineProperty(t,"$key",{enumerable:!1,value:n}):{$key:n,$value:t}}):e}})}(),angular.module("DevTemplates",[]).run(["$templateCache",function(e){e.put("source-editor/dev-files.html",'<div uib-tooltip="{{ vm.fileName }}" ng-click="vm.toggle()">\r\n    {{ vm.fileName.substr(vm.fileName.lastIndexOf("\\\\") + 1) }}\r\n    ({{vm.type }})\r\n    <i ng-class=\'{"eav-icon-plus-squared": !vm.show, "eav-icon-minus-squared": vm.show}\'></i>\r\n</div>\r\n<div ng-if="vm.show">\r\n    <h4>quick-pick another file</h4>\r\n    <ol>\r\n        <li ng-repeat="asset in vm.assets" ng-click="vm.editFile(asset)">\r\n            {{asset}}\r\n        </li>\r\n    </ol>\r\n    <ul>\r\n        <li ng-click="vm.addFile()">create file <span class="eav-icon-plus-circled"></span></li>\r\n        <li>for copy, rename etc. please use the dnn file manager</li>\r\n    </ul>\r\n</div>'),e.put("source-editor/editor.html",'<div ng-click="vm.debug.autoEnableAsNeeded($event)">\r\n    <div class="modal-header">\r\n        <h3 class="modal-title" translate="SourceEditor.Title"></h3>\r\n    </div>\r\n\r\n    <div class="modal-body">\r\n        <div class="row">\r\n            <div class="col-md-8">\r\n                <dev-files file-name="vm.view.FileName" type="vm.view.Type"></dev-files>\r\n\r\n                <div ng-model="vm.view.Code" style="height: 600px;" ui-ace="{\r\n                    useWrapMode : true,\r\n                    useSoftTabs: true,\r\n                    showGutter: true,\r\n                    theme:\'sqlserver\',\r\n                    mode: \'razor\',\r\n                    onLoad: vm.aceLoaded,\r\n                    require: [\'ace/ext/language_tools\', \'//xyz/something\'],\r\n                    advanced: {\r\n                        enableSnippets: true,\r\n                        enableBasicAutocompletion: true,\r\n                        enableLiveAutocompletion: true\r\n                    },\r\n                    rendererOptions: {\r\n                        fontSize: 16\r\n                    }\r\n                }">\r\n                </div>\r\n            </div>\r\n            <div class="pull-right col-md-4">\r\n                <!-- snippets wrapper - should ensure scrolling-->\r\n                <snippets ng-if="vm.snippets" snippets="vm.snippets" editor="vm.editor"></snippets>\r\n            </div>\r\n        </div>\r\n\r\n    </div>\r\n    <div class="modal-footer">\r\n        <div class="pull-left">\r\n            <button class="btn btn-primary btn-lg xxbtn-square" type="button" ng-click="vm.save(false)">\r\n                <span icon="check" uib-tooltip="{{ \'Button.SaveAndKeepOpen\' | translate }}"></span>\r\n                {{ \'Button.SaveAndKeepOpen\' | translate }}\r\n            </button>\r\n            also supports Ctrl+S\r\n        </div>\r\n    </div>\r\n    <show-debug-availability class="pull-right"></show-debug-availability>\r\n    <div ng-if="vm.debug.on">\r\n        <pre>{{vm.view.Code}}</pre>\r\n    </div>\r\n</div>\r\n\r\n<style>\r\n    /* helper to ensure that razor (which is correctly detected by ACE) is also highlighted */\r\n    .ace_razor {\r\n        background-color: yellow;\r\n    }\r\n\r\n    /* make sure the highlighted text is also black, otherwise it a kind of gray */\r\n    .ace_punctuation.ace_short.ace_razor {\r\n        color: black;\r\n    }\r\n\r\n    .ace_punctuation.ace_block.ace_razor {\r\n        color: black;\r\n    }\r\n</style>'),e.put("source-editor/snippets-links.html",'<div>\r\n    <div ng-repeat="link in vm.links">\r\n        &gt; <a href="{{link.url}}" target="_blank">{{link.name}}</a>\r\n    </div>\r\n</div>'),e.put("source-editor/snippets.html",'<div>\r\n    <strong translate="SourceEditor.SnippetsSection.Title"></strong> <i icon="question-sign" style="opacity: 0.3" ng-click="showSnippetInfo = !showSnippetInfo"></i>\r\n    <div ng-if="showSnippetInfo" translate="SourceEditor.SnippetsSection.Intro"></div>\r\n</div>\r\n<select class="input-lg"\r\n        style="width: 90%"\r\n        ng-model="vm.snippetSet"\r\n        ng-options="key as (\'SourceEditorSnippets.\' + key + \'.Title\' | translate) for (key , value) in vm.snippets"\r\n        uib-tooltip="{{ \'SourceEditorSnippets.\' + vm.snippetSet + \'.Help\'  | translate}}"></select>\r\n<div>&nbsp;</div>\r\n<div style="height: 500px; overflow: auto">\r\n    <div ng-repeat="(subsetName, subsetValue) in vm.snippets[vm.snippetSet]">\r\n        <strong uib-tooltip="{{ \'SourceEditorSnippets.\' + vm.snippetSet + \'.\' + subsetName + \'.Help\'  | translate}}">{{ \'SourceEditorSnippets.\' + vm.snippetSet + \'.\' + subsetName + \'.Title\' | translate}}</strong>\r\n        <ul>\r\n            <li ng-repeat="value in subsetValue | toArray | orderBy: \'$key\'" uib-tooltip="{{ value.snip }}">\r\n                <span ng-mouseover="showAdd = true" ng-click="show = !show" ng-mouseout="showAdd = false">\r\n                    <i class="eav-icon-plus-squared"\r\n                       ng-click="vm.addSnippet(value.snip)"\r\n                       ng-show="showAdd"\r\n                       stop-event="click"></i>\r\n                    {{value.label}}\r\n\r\n                    <i icon="info-sign" style="opacity: 0.3" ng-show="value.help"></i>\r\n                    <a ng-show="value.more"\r\n                       ng-click="showMore = !showMore"\r\n                       stop-event="click">\r\n                        <i icon="plus"></i>more\r\n                    </a>\r\n                </span>\r\n                <div ng-if="show">\r\n                    <em>{{value.help}}</em>\r\n                    <snippets-links links="value.links" ng-if="value.links"></snippets-links>\r\n                </div>\r\n                <ul ng-if="showMore">\r\n                    <li ng-repeat="more in value.more | toArray | orderBy: \'$key\'" uib-tooltip="{{ value.snip }}">\r\n                        <span ng-click="vm.addSnippet(more.snip)">{{more.label}}</span>\r\n                        <i icon="info-sign" style="opacity: 0.3" ng-click="show = !show" ng-show="more.help"></i>\r\n                        <div ng-if="show">\r\n                            <em>{{more.help}}</em>\r\n                            <snippets-links links="more.links" ng-if="more.links"></snippets-links>\r\n                        </div>\r\n                </ul>\r\n            </li>\r\n        </ul>\r\n\r\n    </div>\r\n</div>\r\n')}]);
//# sourceMappingURL=sxc-develop.min.js.map
