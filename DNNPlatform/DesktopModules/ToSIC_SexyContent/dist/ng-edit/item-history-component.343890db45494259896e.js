(window.webpackJsonp=window.webpackJsonp||[]).push([[45],{yyn8:function(e,t,n){"use strict";n.r(t),n.d(t,"ItemHistoryComponent",(function(){return Q}));var i=n("D57K"),a=n("C05f"),o=n("HM3f"),c=n("YtkY");function r(e,t,n){var a=JSON.parse(e.Json).Entity.Attributes,o="live"===n?function(e){var t,n,a=e[0];try{for(var o=Object(i.h)(e),c=o.next();!c.done;c=o.next()){var r=c.value;r.VersionNumber<=a.VersionNumber||(a=r)}}catch(s){t={error:s}}finally{try{c&&!c.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return a}(t):t.find((function(t){return t.VersionNumber===e.VersionNumber-1})),c=o?JSON.parse(o.Json).Entity.Attributes:null,r=[];return null!=a&&Object.entries(a).forEach((function(e){var t=Object(i.f)(e,2),n=t[0];Object.keys(t[1]).forEach((function(e){null==r.find((function(t){return t.name===e&&t.dataType===n}))&&r.push({name:e,dataType:n})}))})),null!=c&&Object.entries(c).forEach((function(e){var t=Object(i.f)(e,2),n=t[0];Object.keys(t[1]).forEach((function(e){null==r.find((function(t){return t.name===e&&t.dataType===n}))&&r.push({name:e,dataType:n})}))})),r.map((function(e){var t,n,i=null===(t=null==a?void 0:a[e.dataType])||void 0===t?void 0:t[e.name],o=null===(n=null==c?void 0:c[e.dataType])||void 0===n?void 0:n[e.name];return{name:e.name,dataType:e.dataType,change:l(i,o,!0),values:s(i,o)}}))}function s(e,t){var n=[];return null!=e&&Object.keys(e).forEach((function(e){n.includes(e)||n.push(e)})),null!=t&&Object.keys(t).forEach((function(e){n.includes(e)||n.push(e)})),n.map((function(n){var i=null==e?void 0:e[n],a=null==t?void 0:t[n];return{langKey:n,value:i,oldValue:a,change:l(i,a)}}))}function l(e,t,n){return void 0===n&&(n=!1),n&&("object"==typeof e&&(e=u(e)),"object"==typeof t&&(t=u(t))),null!=e&&null!=t?JSON.stringify(e)!==JSON.stringify(t)?"changed":"none":null!=e?"new":"deleted"}function u(e){return"object"!=typeof e?e:Object.keys(e).sort().reduce((function(t,n){var a;return Object(i.a)(Object(i.a)({},t),((a={})[n]=e[n],a))}),{})}var p=n("EM62"),b=n("OZ4H"),d=n("sEIs"),f=n("ml94"),g=n("W1gw"),h=n("2kYt"),m=n("PBFl"),v=n("Y2X+"),y=n("bFHC"),O=n("29Wa"),S=n("R7+U"),x=n("mFH5"),_=n("3Uyd"),I=n("iAde");function w(e,t){if(1&e){var n=p.Tb();p.Sb(0,"div",9),p.Sb(1,"mat-form-field",10),p.Sb(2,"mat-select",11),p.ac("selectionChange",(function(e){return p.Ac(n),p.ec(2).compareChange(e.value)})),p.Sb(3,"mat-option",12),p.Oc(4,"Compare with: Previous"),p.Rb(),p.Sb(5,"mat-option",13),p.Oc(6,"Compare with: Live"),p.Rb(),p.Rb(),p.Rb(),p.Rb()}if(2&e){var i=p.ec().ngIf;p.Ab(2),p.kc("value",i.compareWith)}}function A(e,t){1&e&&(p.Sb(0,"div"),p.Oc(1,"Loading..."),p.Rb())}function C(e,t){1&e&&(p.Sb(0,"div"),p.Oc(1,"No previous versions of this item found"),p.Rb())}function M(e,t){if(1&e&&(p.Qb(0),p.Oc(1),p.Pb()),2&e){var n=p.ec().$implicit;p.Ab(1),p.Qc(" ",null==n.values[0]?null:n.values[0].value," ")}}function R(e,t){if(1&e&&(p.Sb(0,"div"),p.Oc(1),p.Rb()),2&e){var n=p.ec().$implicit;p.Cb("history-",n.change,""),p.Ab(1),p.Qc(" ","deleted"===n.change?n.oldValue:n.value," ")}}function k(e,t){if(1&e&&(p.Qb(0),p.Sb(1,"div",29),p.Oc(2),p.Rb(),p.Sb(3,"div",30),p.Oc(4),p.Rb(),p.Pb()),2&e){var n=p.ec().$implicit;p.Ab(2),p.Pc(n.value),p.Ab(2),p.Pc(n.oldValue)}}function $(e,t){if(1&e&&(p.Sb(0,"div",26),p.Sb(1,"div"),p.Oc(2),p.Rb(),p.Sb(3,"div",27),p.Mc(4,R,2,4,"div",28),p.Mc(5,k,5,2,"ng-container",0),p.Rb(),p.Rb()),2&e){var n=t.$implicit;p.Ab(1),p.Cb("detail-row__label history-",n.change,""),p.Ab(1),p.Qc("",n.langKey,":"),p.Ab(2),p.kc("ngIf","changed"!==n.change),p.Ab(1),p.kc("ngIf","changed"===n.change)}}function P(e,t){if(1&e&&(p.Sb(0,"div",24),p.Mc(1,$,6,6,"div",25),p.Rb()),2&e){var n=p.ec().$implicit;p.Ab(1),p.kc("ngForOf",n.values)}}function j(e,t){if(1&e){var n=p.Tb();p.Sb(0,"div",20),p.Sb(1,"div",21),p.ac("click",(function(){p.Ac(n);var e=t.$implicit,i=p.ec(2).$implicit;return p.ec(3).attributeExpandedToggle(i.versionNumber,e.name)})),p.Sb(2,"div"),p.Oc(3),p.Rb(),p.Sb(4,"div"),p.Mc(5,M,2,1,"ng-container",0),p.Rb(),p.Sb(6,"div",22),p.Sb(7,"i"),p.Oc(8),p.Rb(),p.Rb(),p.Rb(),p.Mc(9,P,2,1,"div",23),p.Rb()}if(2&e){var i=t.$implicit,a=p.ec(2).$implicit,o=p.ec(3);p.Ab(2),p.Cb("row-main__label history-",i.change,""),p.Ab(1),p.Qc(" ",i.name," "),p.Ab(1),p.Cb("row-main__value history-",i.change,""),p.Ab(1),p.kc("ngIf",!o.expandedAttributes[a.versionNumber+i.name]),p.Ab(3),p.Qc("[",i.dataType,"]"),p.Ab(1),p.kc("ngIf",o.expandedAttributes[a.versionNumber+i.name])}}function z(e,t){if(1&e){var n=p.Tb();p.Sb(0,"button",31),p.ac("click",(function(){p.Ac(n);var e=p.ec(2).$implicit;return p.ec(3).restore(e.changeSetId)})),p.Oc(1," Restore "),p.Rb()}}function N(e,t){if(1&e&&(p.Qb(0),p.Mc(1,j,10,10,"div",17),p.Sb(2,"div",18),p.Mc(3,z,2,0,"button",19),p.Rb(),p.Pb()),2&e){var n=p.ec().$implicit;p.Ab(1),p.kc("ngForOf",n.attributes),p.Ab(2),p.kc("ngIf",!n.isLastVersion)}}function T(e,t){if(1&e){var n=p.Tb();p.Sb(0,"mat-expansion-panel",16),p.ac("expandedChange",(function(e){p.Ac(n);var i=t.$implicit;return p.ec(3).panelExpandedChange(e,i.versionNumber)})),p.Sb(1,"mat-expansion-panel-header"),p.Sb(2,"mat-panel-title"),p.Oc(3),p.Rb(),p.Sb(4,"mat-panel-description"),p.Oc(5),p.fc(6,"date"),p.Rb(),p.Rb(),p.Mc(7,N,4,2,"ng-container",0),p.Rb()}if(2&e){var i=t.$implicit,a=p.ec(3);p.kc("expanded",a.expandedPanels[i.versionNumber]),p.Ab(3),p.Qc("Version ",i.versionNumber,""),p.Ab(2),p.Pc(p.hc(6,4,i.timeStamp,"yyyy-MM-dd hh:mm")),p.Ab(2),p.kc("ngIf",a.expandedPanels[i.versionNumber])}}function V(e,t){if(1&e&&(p.Sb(0,"mat-accordion",14),p.Mc(1,T,8,7,"mat-expansion-panel",15),p.Rb()),2&e){var n=p.ec().ngIf;p.Ab(1),p.kc("ngForOf",n.historyItems)}}function E(e,t){if(1&e){var n=p.Tb();p.Sb(0,"mat-paginator",32),p.ac("page",(function(e){return p.Ac(n),p.ec(2).pageChange(e)})),p.Rb()}if(2&e){var i=p.ec().ngIf,a=p.ec();p.kc("length",i.length)("pageSize",i.pageSize)("pageSizeOptions",a.pageSizeOptions)}}function F(e,t){if(1&e){var n=p.Tb();p.Qb(0),p.Sb(1,"div",1),p.Sb(2,"div",2),p.Sb(3,"div"),p.Oc(4,"Item History"),p.Rb(),p.Sb(5,"button",3),p.ac("click",(function(){return p.Ac(n),p.ec().closeDialog()})),p.Sb(6,"mat-icon"),p.Oc(7,"close"),p.Rb(),p.Rb(),p.Rb(),p.Rb(),p.Sb(8,"p",4),p.Oc(9,"Check version history for this item and restore the version you need."),p.Rb(),p.Mc(10,w,7,1,"div",5),p.Sb(11,"div",6),p.Mc(12,A,2,0,"div",0),p.Mc(13,C,2,0,"div",0),p.Mc(14,V,2,1,"mat-accordion",7),p.Rb(),p.Mc(15,E,1,3,"mat-paginator",8),p.Pb()}if(2&e){var i=t.ngIf;p.Ab(10),p.kc("ngIf",(null==i.historyItems?null:i.historyItems.length)>0),p.Ab(2),p.kc("ngIf",null===i.historyItems),p.Ab(1),p.kc("ngIf",0===(null==i.historyItems?null:i.historyItems.length)),p.Ab(1),p.kc("ngIf",(null==i.historyItems?null:i.historyItems.length)>0),p.Ab(1),p.kc("ngIf",(null==i.historyItems?null:i.historyItems.length)>0)}}var Q=function(){function e(e,t,n,s){this.dialogRef=e,this.route=t,this.versionsService=n,this.snackBar=s,this.hostClass="dialog-component",this.pageSizeOptions=[10,20,50],this.expandedPanels={},this.expandedAttributes={},this.itemId=parseInt(this.route.snapshot.paramMap.get("itemId"),10),this.versions$=new a.a(null),this.page$=new a.a(1),this.pageSize$=new a.a(this.pageSizeOptions[0]),this.compareWith$=new a.a("live"),this.historyItems$=Object(o.a)([this.versions$,this.page$,this.pageSize$,this.compareWith$]).pipe(Object(c.a)((function(e){var t,n,a,o,c=Object(i.f)(e,4);return n=c[1],a=c[2],o=c[3],null==(t=c[0])||null==n||null==a||null==o?null:function(e,t,n){return e.map((function(e){return{changeSetId:e.ChangeSetId,attributes:r(e,t,n),historyId:e.HistoryId,timeStamp:e.TimeStamp,user:e.User,versionNumber:e.VersionNumber,isLastVersion:!t.some((function(t){return t.VersionNumber===e.VersionNumber+1}))}}))}(t.slice((n-1)*a,n*a),t,o)}))),this.templateVars$=Object(o.a)([this.versions$,this.historyItems$,this.pageSize$,this.compareWith$]).pipe(Object(c.a)((function(e){var t=Object(i.f)(e,4),n=t[0];return{length:null==n?void 0:n.length,historyItems:t[1],pageSize:t[2],compareWith:t[3]}})))}return e.prototype.ngOnInit=function(){var e=this;this.versionsService.fetchVersions(this.itemId).subscribe((function(t){e.versions$.next(t)}))},e.prototype.ngOnDestroy=function(){this.versions$.complete(),this.page$.complete(),this.pageSize$.complete(),this.compareWith$.complete()},e.prototype.closeDialog=function(){this.dialogRef.close()},e.prototype.compareChange=function(e){this.compareWith$.next(e)},e.prototype.panelExpandedChange=function(e,t){this.expandedPanels[t]=e},e.prototype.attributeExpandedToggle=function(e,t){this.expandedAttributes[e+t]=!this.expandedAttributes[e+t]},e.prototype.pageChange=function(e){var t=e.pageIndex+1;t!==this.page$.value&&(this.expandedPanels={},this.expandedAttributes={},this.page$.next(t));var n=e.pageSize;n!==this.pageSize$.value&&this.pageSize$.next(n)},e.prototype.restore=function(e){var t=this;this.snackBar.open("Restoring previous version..."),this.versionsService.restore(this.itemId,e).subscribe((function(e){t.snackBar.open("Previous version restored. Will reload edit dialog",null,{duration:3e3}),t.dialogRef.close({refreshEdit:!0})}))},e.\u0275fac=function(t){return new(t||e)(p.Mb(b.g),p.Mb(d.a),p.Mb(f.a),p.Mb(g.b))},e.\u0275cmp=p.Gb({type:e,selectors:[["app-item-history"]],hostVars:1,hostBindings:function(e,t){2&e&&p.Vb("className",t.hostClass)},decls:2,vars:3,consts:[[4,"ngIf"],["mat-dialog-title",""],[1,"dialog-title-box"],["mat-icon-button","","matTooltip","Close dialog",3,"click"],[1,"dialog-description"],["class","compare-box",4,"ngIf"],[1,"dialog-component-content","fancy-scrollbar-light"],["multi","","class","history-tables",4,"ngIf"],["color","accent","showFirstLastButtons","true",3,"length","pageSize","pageSizeOptions","page",4,"ngIf"],[1,"compare-box"],["appearance","standard","color","accent",1,"compare-box__dropdown"],["name","Scope",3,"value","selectionChange"],["value","previous"],["value","live"],["multi","",1,"history-tables"],[3,"expanded","expandedChange",4,"ngFor","ngForOf"],[3,"expanded","expandedChange"],["class","table-row",4,"ngFor","ngForOf"],[1,"row-actions"],["mat-raised-button","","color","accent",3,"click",4,"ngIf"],[1,"table-row"],[1,"table-row__main","row-main",3,"click"],[1,"row-main__type"],["class","table-row__details",4,"ngIf"],[1,"table-row__details"],["class","detail-row",4,"ngFor","ngForOf"],[1,"detail-row"],[1,"detail-row__value"],[3,"class",4,"ngIf"],[1,"history-new"],[1,"history-deleted","history-deleted__value"],["mat-raised-button","","color","accent",3,"click"],["color","accent","showFirstLastButtons","true",3,"length","pageSize","pageSizeOptions","page"]],template:function(e,t){1&e&&(p.Mc(0,F,16,5,"ng-container",0),p.fc(1,"async")),2&e&&p.kc("ngIf",p.gc(1,1,t.templateVars$))},directives:[h.t,b.h,m.b,v.a,y.a,O.c,S.a,x.m,_.a,h.s,_.c,_.e,_.f,_.d,I.a],pipes:[h.b,h.f],styles:[".compare-box[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;align-items:flex-end;height:40px}.compare-box__dropdown[_ngcontent-%COMP%]{width:192px;margin-top:-14px;font-size:14px;height:auto}.mat-accordion[_ngcontent-%COMP%]{display:block;padding:4px 0}.mat-expansion-panel-header[_ngcontent-%COMP%], .table-row[_ngcontent-%COMP%]{font-size:14px}.table-row__main[_ngcontent-%COMP%]{display:flex}.table-row__details[_ngcontent-%COMP%]{display:block}.row-main[_ngcontent-%COMP%]{cursor:pointer;padding:4px 0}.row-main__label[_ngcontent-%COMP%]{width:160px;flex:0 0 auto}.row-main__value[_ngcontent-%COMP%]{flex:1 1 auto}.row-main__type[_ngcontent-%COMP%]{flex:0 0 auto;font-size:12px}.row-main__type[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]:not(:last-of-type){margin-right:2px}.detail-row[_ngcontent-%COMP%]{display:flex;padding-bottom:4px;cursor:default}.detail-row__label[_ngcontent-%COMP%]{width:160px;flex:0 0 auto}.detail-row__value[_ngcontent-%COMP%]{flex:1 1 auto}.row-actions[_ngcontent-%COMP%]{margin-top:16px;display:flex;justify-content:flex-end}"],changeDetection:0}),e}()}}]);
//# sourceMappingURL=https://sources.2sxc.org/11.11.04/ng-edit/item-history-component.343890db45494259896e.js.map