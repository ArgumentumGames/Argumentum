"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_metadata_metadata_component_ts","projects_eav-ui_src_app_shared_directives_click-stop-propagation_directive_ts"],{8812:(E,T,i)=>{i.d(T,{l:()=>M});var r=i(7400),h=i(2673),n=i(635),C=i(898),_=i(2847),d=i(9934),x=i(5368),v=i(3184),Z=i(8784),A=i(2425);let M=(()=>{class p{constructor(t,f,D){this.http=t,this.context=f,this.dnnContext=D}getAll(t){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(_.PS),{params:{appId:this.context.appId.toString(),contentType:t}})}getColumns(t){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(C.jt),{params:{appId:this.context.appId.toString(),staticName:t}})}importItem(t){return(0,r.D)((0,d.s)(t)).pipe((0,h.w)(f=>this.http.post(this.dnnContext.$2sxc.http.apiUrl(_.Uo+"upload"),{AppId:this.context.appId.toString(),ContentBase64:f})),(0,n.U)(f=>({Success:f,Messages:[]})))}}return p.\u0275fac=function(t){return new(t||p)(v.LFG(Z.eN),v.LFG(x._),v.LFG(A._y))},p.\u0275prov=v.Yz7({token:p,factory:p.\u0275fac}),p})()},3265:(E,T,i)=>{i.d(T,{f:()=>_});var r=i(3184),h=i(8784),n=i(2425);let _=(()=>{class d{constructor(v,Z){this.http=v,this.dnnContext=Z}getFeatureDetails(v){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/feature/details"),{params:{nameId:v}})}}return d.\u0275fac=function(v){return new(v||d)(r.LFG(h.eN),r.LFG(n._y))},d.\u0275prov=r.Yz7({token:d,factory:d.\u0275fac}),d})()},1329:(E,T,i)=>{i.d(T,{B:()=>S});var r=i(5758),h=i(9673),n=i(3184),C=i(2528),_=i(3265),d=i(6362),x=i(6190),v=i(7317),Z=i(5590),A=i(1555),M=i(7514);function p(m,b){if(1&m){const l=n.EpF();n.TgZ(0,"div",5)(1,"div",6),n._uU(2,"ID"),n.qZA(),n.TgZ(3,"div",12)(4,"span",13),n.NdJ("click",function(){const I=n.CHM(l).ngIf;return n.oxw(2).copyToClipboard(I)}),n._uU(5),n.qZA()()()}if(2&m){const l=b.ngIf;n.xp6(4),n.Q6J("tippy",l),n.xp6(1),n.Oqu(l)}}function u(m,b){if(1&m){const l=n.EpF();n.TgZ(0,"button",14),n.NdJ("click",function(){const I=n.CHM(l).ngIf;return n.oxw(2).findOutMore(I)}),n.TgZ(1,"mat-icon"),n._uU(2,"open_in_new"),n.qZA(),n._uU(3),n.ALo(4,"translate"),n.qZA()}2&m&&(n.xp6(3),n.hij(" ",n.lcZ(4,1,"Features.FindOutMore")," "))}function t(m,b){if(1&m){const l=n.EpF();n.TgZ(0,"div")(1,"div",1)(2,"div",2)(3,"div"),n._uU(4),n.qZA()()(),n._UZ(5,"p",3),n.ALo(6,"safeHtml"),n.TgZ(7,"div",4)(8,"div",5)(9,"div",6),n._uU(10),n.ALo(11,"translate"),n.qZA(),n.TgZ(12,"div",7)(13,"span"),n._uU(14),n.ALo(15,"translate"),n.qZA()()(),n.YNc(16,p,6,2,"div",8),n.qZA(),n.TgZ(17,"div",9),n.YNc(18,u,5,3,"button",10),n.TgZ(19,"button",11),n.NdJ("click",function(){return n.CHM(l),n.oxw().closeDialog()}),n._uU(20),n.ALo(21,"translate"),n.qZA()()()}if(2&m){const l=b.ngIf;n.xp6(4),n.Oqu(l.Name),n.xp6(1),n.Q6J("innerHtml",n.lcZ(6,7,l.Description),n.oJD),n.xp6(5),n.Oqu(n.lcZ(11,9,"Features.Status")),n.xp6(4),n.Oqu(n.lcZ(15,11,l.Enabled?"Features.Active":"Features.NotActive")),n.xp6(2),n.Q6J("ngIf",l.NameId),n.xp6(2),n.Q6J("ngIf",l.Link),n.xp6(2),n.hij(" ",n.lcZ(21,13,"Features.Close")," ")}}let f=(()=>{class m{constructor(l,g,O,I){this.dialogData=l,this.dialogRef=g,this.snackBar=O,this.featureDetailService=I,this.feature$=this.featureDetailService.getFeatureDetails(l)}ngOnInit(){}copyToClipboard(l){(0,h.v)(l),this.snackBar.open("Copied to clipboard",null,{duration:2e3})}findOutMore(l){window.open(l,"_blank")}closeDialog(){this.dialogRef.close()}}return m.\u0275fac=function(l){return new(l||m)(n.Y36(r.WI),n.Y36(r.so),n.Y36(C.ux),n.Y36(_.f))},m.\u0275cmp=n.Xpm({type:m,selectors:[["app-feature-info-dialog"]],decls:2,vars:3,consts:[[4,"ngIf"],["mat-dialog-title",""],[1,"dialog-title-box"],[1,"dialog-description",3,"innerHtml"],[1,"info-box"],[1,"info-row"],[1,"info-row__label"],[1,"info-row__value"],["class","info-row",4,"ngIf"],[1,"dialog-component-actions"],["mat-raised-button","","class","dialog-component-button","color","accent",3,"click",4,"ngIf"],["mat-raised-button","",1,"dialog-component-button",3,"click"],[1,"info-row__value","click"],[3,"tippy","click"],["mat-raised-button","","color","accent",1,"dialog-component-button",3,"click"]],template:function(l,g){1&l&&(n.YNc(0,t,22,15,"div",0),n.ALo(1,"async")),2&l&&n.Q6J("ngIf",n.lcZ(1,1,g.feature$))},directives:[d.O5,x.$,v.lW,Z.Hw],pipes:[d.Ov,A.z,M.X$],styles:[".info-box[_ngcontent-%COMP%]{margin-top:32px}.info-row[_ngcontent-%COMP%]{display:flex;overflow-wrap:anywhere;margin-top:4px;margin-bottom:4px;font-size:14px}.info-row__label[_ngcontent-%COMP%]{flex:1;font-weight:500}.info-row__value[_ngcontent-%COMP%]{flex:3}.info-row__value.click[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{cursor:pointer}.dialog-component-actions[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;margin-top:16px}.dialog-component-button[_ngcontent-%COMP%]{margin-left:8px}"]}),m})();var D=i(6317),$=i(2673),w=i(6562),R=i(635),J=i(5916);let S=(()=>{class m{constructor(l,g,O,I){this.dialog=l,this.viewContainerRef=g,this.changeDetectorRef=O,this.featuresService=I,this.featureNameId$=new D.X(null),this.showIf$=new D.X(!1),this.feature$=this.featureNameId$.pipe((0,$.w)(F=>this.featuresService.get$(F))),this.show$=(0,w.a)([this.feature$,this.showIf$]).pipe((0,R.U)(([F,k])=>{var U;return k==(null!==(U=null==F?void 0:F.Enabled)&&void 0!==U&&U)}))}set featureNameId(l){this.featureNameId$.next(l)}set showIf(l){this.showIf$.next(1==l)}openDialog(){m.openDialog(this.dialog,this.featureNameId$.value,this.viewContainerRef,this.changeDetectorRef)}static openDialog(l,g,O,I){l.open(f,{autoFocus:!1,data:g,viewContainerRef:O,width:"600px"}),I.markForCheck()}}return m.\u0275fac=function(l){return new(l||m)(n.Y36(r.uw),n.Y36(n.s_b),n.Y36(n.sBO),n.Y36(J.k))},m.\u0275dir=n.lG2({type:m,inputs:{featureNameId:"featureNameId",showIf:"showIf"}}),m})()},9756:(E,T,i)=>{i.r(T),i.d(T,{MetadataComponent:()=>yt});var r=i(6317),h=i(6562),n=i(635),C=i(9337),_=i(8812),d=i(4272),x=i(2925),v=i(60),Z=i(2087),A=i(4153),M=i(941),p=i(2225),u=i(5758),t=i(3184),f=i(6362),D=i(7317),$=i(1555);function w(o,c){if(1&o&&(t._UZ(0,"div",5),t.ALo(1,"safeHtml")),2&o){const e=t.oxw();t.Q6J("innerHtml",t.lcZ(1,1,e.dialogData.message),t.oJD)}}let R=(()=>{class o{constructor(e,a){this.dialogData=e,this.dialogRef=a,this.hostClass="dialog-component"}closeDialog(e){this.dialogRef.close(e)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(u.WI),t.Y36(u.so))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-confirm-delete-dialog"]],hostVars:1,hostBindings:function(e,a){2&e&&t.Ikx("className",a.hostClass)},decls:9,vars:3,consts:[["mat-dialog-title",""],[1,"dialog-title-box"],["class","dialog-component-content fancy-scrollbar-light",3,"innerHtml",4,"ngIf"],[1,"dialog-component-actions"],["mat-raised-button","",3,"click"],[1,"dialog-component-content","fancy-scrollbar-light",3,"innerHtml"]],template:function(e,a){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._uU(2),t.qZA()(),t.YNc(3,w,2,3,"div",2),t.TgZ(4,"div",3)(5,"button",4),t.NdJ("click",function(){return a.closeDialog()}),t._uU(6,"Cancel"),t.qZA(),t.TgZ(7,"button",4),t.NdJ("click",function(){return a.closeDialog(!0)}),t._uU(8,"Delete"),t.qZA()()),2&e&&(t.xp6(2),t.AsE("Delete ",a.dialogData.entityTitle," (",a.dialogData.entityId,")?"),t.xp6(1),t.Q6J("ngIf",a.dialogData.message))},directives:[u.uh,f.O5,D.lW],pipes:[$.z],styles:[".dialog-component-content[_ngcontent-%COMP%]{font-size:14px}"]}),o})();var J=i(1130),S=i(6190),m=i(5590);let b=(()=>{class o{agInit(e){this.params=e}refresh(e){return!0}deleteMetadata(){this.params.onDelete(this.params.data)}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-metadata-actions"]],decls:4,vars:0,consts:[[1,"actions-component"],["matRipple","","tippy","Delete",1,"like-button","highlight",3,"click"]],template:function(e,a){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t.NdJ("click",function(){return a.deleteMetadata()}),t.TgZ(2,"mat-icon"),t._uU(3,"delete"),t.qZA()()())},directives:[J.wG,S.$,m.Hw],styles:[""]}),o})(),l=(()=>{class o{agInit(e){this.value=e.value,this.metadata=e.data}refresh(e){return!0}}return o.\u0275fac=function(e){return new(e||o)},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-metadata-content-type"]],decls:2,vars:3,consts:[[1,"container",3,"tippy","tippyDisabled"]],template:function(e,a){1&e&&(t.TgZ(0,"div",0),t._uU(1),t.qZA()),2&e&&(t.Q6J("tippy",a.metadata._Type.Description)("tippyDisabled",!a.metadata._Type.Description),t.xp6(1),t.hij(" ",a.value,"\n"))},directives:[S.$],styles:[".container[_ngcontent-%COMP%]{width:-moz-fit-content;width:fit-content}"]}),o})();var g=i(587),O=i(4874),I=i(8977),F=i(4536),k=i(2270),U=i(4770),L=i(1434),W=i(8352),G=i(7294),j=i(4683),K=i(6623);function V(o,c){if(1&o&&(t.TgZ(0,"mat-option",21),t._uU(1),t.qZA()),2&o){const e=c.$implicit;t.Q6J("value",e.value),t.xp6(1),t.hij(" ",e.name," ")}}function X(o,c){if(1&o&&(t.ynx(0),t.TgZ(1,"mat-form-field",7)(2,"mat-label"),t._uU(3,"Scope"),t.qZA(),t.TgZ(4,"mat-select",19),t.YNc(5,V,2,2,"mat-option",20),t.TgZ(6,"mat-option",21),t._uU(7,"Other..."),t.qZA()()(),t.TgZ(8,"app-field-hint"),t._uU(9," The scope should almost never be changed - "),t.TgZ(10,"a",22),t._uU(11,"see help"),t.qZA()(),t.BQk()),2&o){const e=t.oxw().ngIf,a=t.oxw();t.xp6(4),t.Q6J("placeholder",e.scopeOptions.length?"":"No items found"),t.xp6(1),t.Q6J("ngForOf",e.scopeOptions),t.xp6(1),t.Q6J("value",a.dropdownInsertValue)}}function z(o,c){if(1&o&&(t.TgZ(0,"mat-option",21),t._uU(1),t.qZA()),2&o){const e=c.$implicit;t.Q6J("value",e.StaticName),t.xp6(1),t.hij(" ",e.Label," ")}}function q(o,c){if(1&o&&(t.TgZ(0,"mat-select",23),t.YNc(1,z,2,2,"mat-option",20),t.qZA()),2&o){const e=t.oxw().ngIf;t.Q6J("placeholder",e.contentTypes.length?"":"No items found"),t.xp6(1),t.Q6J("ngForOf",e.contentTypes)}}function tt(o,c){1&o&&t._UZ(0,"input",24)}function et(o,c){1&o&&(t.TgZ(0,"app-field-hint",25),t._uU(1," This field is required "),t.qZA()),2&o&&t.Q6J("isError",!0)}const H=function(o){return{active:o}};function nt(o,c){if(1&o){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",1)(2,"div",2),t._uU(3,"Create Metadata"),t.qZA()(),t.TgZ(4,"p",3),t._uU(5," This is a special operation to add an item which is metadata for another item, see "),t.TgZ(6,"a",4),t._uU(7,"docs"),t.qZA(),t._uU(8,". "),t.qZA(),t.TgZ(9,"form",5)(10,"div",6),t.YNc(11,X,12,3,"ng-container",0),t.TgZ(12,"mat-form-field",7)(13,"mat-label"),t._uU(14,"Content Type"),t.qZA(),t.YNc(15,q,2,2,"mat-select",8),t.YNc(16,tt,1,0,"input",9),t.TgZ(17,"div",10)(18,"button",11),t.NdJ("click",function(){return t.CHM(e),t.oxw().toggleGuidedContentType(!0)}),t.TgZ(19,"mat-icon"),t._uU(20,"search"),t.qZA()(),t.TgZ(21,"button",12),t.NdJ("click",function(){return t.CHM(e),t.oxw().toggleGuidedContentType(!1)}),t.TgZ(22,"mat-icon"),t._uU(23,"text_fields"),t.qZA()()()(),t.YNc(24,et,2,1,"app-field-hint",13),t.qZA(),t.TgZ(25,"div",14)(26,"mat-slide-toggle",15),t.NdJ("change",function(s){return t.CHM(e),t.oxw().toggleAdvancedMode(s)}),t._uU(27),t.qZA(),t._UZ(28,"div",16),t.TgZ(29,"button",17),t.NdJ("click",function(){return t.CHM(e),t.oxw().closeDialog()}),t._uU(30,"Cancel"),t.qZA(),t.TgZ(31,"button",18),t.NdJ("click",function(){return t.CHM(e),t.oxw().confirm()}),t._uU(32," Confirm "),t.qZA()()(),t.BQk()}if(2&o){const e=t.oxw();t.xp6(9),t.Q6J("formGroup",e.form),t.xp6(2),t.Q6J("ngIf",e.advancedMode&&e.guidedContentType),t.xp6(4),t.Q6J("ngIf",e.guidedContentType),t.xp6(1),t.Q6J("ngIf",!e.guidedContentType),t.xp6(2),t.Q6J("ngClass",t.VKq(10,H,e.guidedContentType)),t.xp6(3),t.Q6J("ngClass",t.VKq(12,H,!e.guidedContentType)),t.xp6(3),t.Q6J("ngIf",e.form.controls.contentType.touched&&(null==e.form.controls.contentType.errors?null:e.form.controls.contentType.errors.required)),t.xp6(2),t.Q6J("checked",e.advancedMode),t.xp6(1),t.hij(" ",e.advancedMode?"Advanced":"Simple"," "),t.xp6(4),t.Q6J("disabled",!e.form.valid)}}let ot=(()=>{class o{constructor(e,a){this.dialogRef=e,this.contentTypesService=a,this.hostClass="dialog-component",this.dropdownInsertValue=k.G,this.guidedContentType=!0,this.advancedMode=!1}ngOnInit(){this.contentTypes$=new r.X([]),this.scopeOptions$=new r.X([]),this.buildForm(),this.fetchScopes(),this.templateVars$=(0,h.a)([this.contentTypes$,this.scopeOptions$]).pipe((0,n.U)(([e,a])=>({contentTypes:e,scopeOptions:a})))}ngOnDestroy(){this.contentTypes$.complete(),this.scopeOptions$.complete()}closeDialog(e){this.dialogRef.close(e)}toggleGuidedContentType(e){this.guidedContentType=e}toggleAdvancedMode(e){this.advancedMode=e.checked}confirm(){const e=this.form.getRawValue();this.closeDialog(e.contentType)}buildForm(){this.form=new g.cw({}),this.form.addControl("contentType",new g.NI(null,[g.kI.required])),this.form.addControl("scope",new g.NI(M.Zy.scopes.default.value)),this.form.controls.scope.valueChanges.pipe((0,O.O)(this.form.controls.scope.value),(0,I.x)()).subscribe(e=>{null!=this.form.controls.contentType.value&&this.form.controls.contentType.patchValue(null),e===k.G?(e=prompt("This is an advanced feature to show content-types of another scope. Don't use this if you don't know what you're doing, as content-types of other scopes are usually hidden for a good reason.")||M.Zy.scopes.default.value,this.scopeOptions$.value.some(a=>a.value===e)||this.scopeOptions$.next([{name:e,value:e},...this.scopeOptions$.value]),this.form.controls.scope.patchValue(e)):this.fetchContentTypes(e)})}fetchContentTypes(e){this.contentTypesService.retrieveContentTypes(e).subscribe(a=>{this.contentTypes$.next(a)})}fetchScopes(){this.contentTypesService.getScopes().subscribe(e=>{this.scopeOptions$.next(e)})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(u.so),t.Y36(F.sF))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-metadata-save-dialog"]],hostVars:1,hostBindings:function(e,a){2&e&&t.Ikx("className",a.hostClass)},decls:2,vars:3,consts:[[4,"ngIf"],["mat-dialog-title",""],[1,"dialog-title-box"],[1,"dialog-description"],["href","http://r.2sxc.org/metadata","target","_blank"],[1,"dialog-form",3,"formGroup"],[1,"dialog-form-content","fancy-scrollbar-light"],["appearance","standard","color","accent"],["formControlName","contentType","required","",3,"placeholder",4,"ngIf"],["matInput","","type","text","formControlName","contentType","required","",4,"ngIf"],["matSuffix","",1,"selection-suffix"],["mat-icon-button","","type","button","tippy","Pick existing value",3,"ngClass","click"],["mat-icon-button","","type","button","tippy","Manual entry",3,"ngClass","click"],[3,"isError",4,"ngIf"],[1,"dialog-form-actions"],["color","accent",3,"checked","change"],[1,"spacer"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"disabled","click"],["formControlName","scope",3,"placeholder"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["href","https://2sxc.org/help?tag=scope","target","_blank","appClickStopPropagation",""],["formControlName","contentType","required","",3,"placeholder"],["matInput","","type","text","formControlName","contentType","required",""],[3,"isError"]],template:function(e,a){1&e&&(t.YNc(0,nt,33,14,"ng-container",0),t.ALo(1,"async")),2&e&&t.Q6J("ngIf",t.lcZ(1,1,a.templateVars$))},directives:[f.O5,u.uh,g._Y,g.JL,g.sg,U.KE,U.hX,L.gD,g.JJ,g.u,f.sg,J.ey,W.Y,G.E,g.Q7,j.Nt,g.Fj,U.R9,D.lW,S.$,f.mk,m.Hw,K.Rr],pipes:[f.Ov],styles:[".dialog-form-content[_ngcontent-%COMP%]   .mat-form-field[_ngcontent-%COMP%]:not(:first-of-type){margin-top:8px}"]}),o})();var at=i(1329),B=i(2977),it=i(2528),st=i(1350),Y=i(7465),rt=i(178);function ct(o,c){1&o&&(t.ynx(0),t._uU(1,"This item is not metadata for anything else."),t.BQk())}function lt(o,c){if(1&o&&(t.ynx(0),t._UZ(1,"br"),t._uU(2),t.BQk()),2&o){const e=t.oxw(2).ngIf;t.xp6(2),t.hij("Number: ",e.itemFor.Number,"")}}function pt(o,c){if(1&o&&(t.ynx(0),t._UZ(1,"br"),t._uU(2),t.BQk()),2&o){const e=t.oxw(2).ngIf;t.xp6(2),t.hij("Guid: ",e.itemFor.Guid,"")}}function dt(o,c){if(1&o&&(t.ynx(0),t._UZ(1,"br"),t._uU(2),t.BQk()),2&o){const e=t.oxw(2).ngIf;t.xp6(2),t.hij("String: ",e.itemFor.String,"")}}function mt(o,c){if(1&o&&(t.ynx(0),t._UZ(1,"br"),t._uU(2),t.BQk()),2&o){const e=t.oxw(2).ngIf;t.xp6(2),t.hij("Title: ",e.itemFor.String,"")}}function gt(o,c){if(1&o&&(t.ynx(0),t._uU(1," This item is metadata for: "),t._UZ(2,"br"),t._uU(3),t._UZ(4,"br"),t._uU(5),t.YNc(6,lt,3,1,"ng-container",0),t.YNc(7,pt,3,1,"ng-container",0),t.YNc(8,dt,3,1,"ng-container",0),t.YNc(9,mt,3,1,"ng-container",0),t.BQk()),2&o){const e=t.oxw().ngIf;t.xp6(3),t.hij("Target: ",e.itemFor.Target," "),t.xp6(2),t.hij("TargetType: ",e.itemFor.TargetType," "),t.xp6(1),t.Q6J("ngIf",e.itemFor.Number),t.xp6(1),t.Q6J("ngIf",e.itemFor.Guid),t.xp6(1),t.Q6J("ngIf",e.itemFor.String),t.xp6(1),t.Q6J("ngIf",e.itemFor.Title)}}function ft(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",11),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).createMetadata()}),t.TgZ(1,"mat-icon"),t._uU(2,"add"),t.qZA()()}}function _t(o,c){1&o&&t._UZ(0,"div")}function ut(o,c){if(1&o&&(t._UZ(0,"div",22),t.ALo(1,"safeHtml")),2&o){const e=t.oxw().$implicit;t.Q6J("innerHTML",t.lcZ(1,2,e.Icon),t.oJD)("matBadgeHidden",e.Enabled)}}function ht(o,c){1&o&&(t.TgZ(0,"mat-icon"),t._uU(1,"add"),t.qZA())}function vt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"button",18),t.NdJ("click",function(){const y=t.CHM(e).$implicit;return t.oxw(3).createMetadata(y)}),t.YNc(1,_t,1,0,"div",19),t.YNc(2,ut,2,4,"ng-template",null,20,t.W1O),t.YNc(4,ht,2,0,"ng-template",null,21,t.W1O),t.qZA()}if(2&o){const e=c.$implicit,a=t.MAs(3),s=t.MAs(5);t.uIk("label",e.Title),t.xp6(1),t.Q6J("ngIf",e.Icon)("ngIfThen",a)("ngIfElse",s)}}const Ct=function(o){return{"fab-opened":o}};function Tt(o,c){if(1&o){const e=t.EpF();t.TgZ(0,"eco-fab-speed-dial",12),t.NdJ("openChange",function(s){return t.CHM(e),t.oxw(2).openChange(s)}),t.TgZ(1,"eco-fab-speed-dial-trigger",13)(2,"button",14)(3,"mat-icon",15),t._uU(4),t.qZA()()(),t.TgZ(5,"eco-fab-speed-dial-actions")(6,"button",16),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).createMetadata()}),t.TgZ(7,"mat-icon"),t._uU(8,"search"),t.qZA()(),t.YNc(9,vt,6,4,"button",17),t.qZA()()}if(2&o){const e=t.oxw().ngIf;t.Q6J("ngClass",t.VKq(4,Ct,e.fabOpen)),t.xp6(1),t.Q6J("spin",!0),t.xp6(3),t.Oqu(e.fabOpen?"close":"add"),t.xp6(5),t.Q6J("ngForOf",e.recommendations)}}function xt(o,c){if(1&o){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",1)(2,"div",2)(3,"div",3)(4,"div"),t._uU(5),t.qZA(),t.TgZ(6,"button",4),t.NdJ("click",function(){return t.CHM(e),t.oxw().closeDialog()}),t.TgZ(7,"mat-icon"),t._uU(8,"close"),t.qZA()()()(),t.TgZ(9,"p",5),t.YNc(10,ct,2,0,"ng-container",0),t.YNc(11,gt,10,6,"ng-container",0),t.qZA(),t._UZ(12,"router-outlet"),t.TgZ(13,"div",6),t._UZ(14,"ag-grid-angular",7)(15,"div",8),t.YNc(16,ft,3,0,"button",9),t.YNc(17,Tt,10,6,"eco-fab-speed-dial",10),t.qZA()(),t.BQk()}if(2&o){const e=c.ngIf,a=t.oxw();t.xp6(5),t.Oqu(a.title||"Metadata"),t.xp6(5),t.Q6J("ngIf",!e.itemFor),t.xp6(1),t.Q6J("ngIf",e.itemFor),t.xp6(3),t.Q6J("rowData",e.metadata)("gridOptions",a.gridOptions),t.xp6(2),t.Q6J("ngIf",0===e.recommendations.length),t.xp6(1),t.Q6J("ngIf",e.recommendations.length>0)}}let yt=(()=>{class o extends v.H{constructor(e,a,s,y,N,P,Mt,It,Dt,bt){var Q;super(e,a),this.router=e,this.route=a,this.dialogRef=s,this.metadataService=y,this.snackBar=N,this.entitiesService=P,this.contentItemsService=Mt,this.dialog=It,this.viewContainerRef=Dt,this.changeDetectorRef=bt,this.gridOptions=this.buildGridOptions(),this.metadata$=new r.X([]),this.recommendations$=new r.X([]),this.itemFor$=new r.X(void 0),this.fabOpen$=new r.X(!1),this.targetType=parseInt(this.route.snapshot.paramMap.get("targetType"),10),this.keyType=this.route.snapshot.paramMap.get("keyType"),this.key=this.route.snapshot.paramMap.get("key"),this.title=decodeURIComponent(null!==(Q=this.route.snapshot.paramMap.get("title"))&&void 0!==Q?Q:""),this.contentTypeStaticName=this.route.snapshot.paramMap.get("contentTypeStaticName")}ngOnInit(){this.fetchFor(),this.fetchMetadata(),this.subscription.add(this.refreshOnChildClosedShallow().subscribe(()=>{this.fetchMetadata()}));const e=(0,h.a)([this.metadata$,this.recommendations$]).pipe((0,n.U)(([a,s])=>s.filter(y=>a.filter(N=>N._Type.Id===y.Id).length<y.Count)));this.templateVars$=(0,h.a)([this.metadata$,e,this.itemFor$,this.fabOpen$]).pipe((0,n.U)(([a,s,y,N])=>({metadata:a,recommendations:s,itemFor:y,fabOpen:N})))}ngOnDestroy(){this.metadata$.complete(),this.recommendations$.complete(),this.itemFor$.complete(),this.fabOpen$.complete(),super.ngOnDestroy()}closeDialog(){this.dialogRef.close()}openChange(e){this.fabOpen$.next(e)}createMetadata(e){if(e)return e.Enabled?void(e.CreateEmpty?(this.snackBar.open(`Creating ${e.Name}...`),this.entitiesService.create(e.Id,{For:this.calculateItemFor()}).subscribe({error:()=>{this.snackBar.open(`Creating ${e.Name} failed. Please check console for more info`,void 0,{duration:3e3}),this.fetchMetadata()},next:()=>{this.snackBar.open(`Created ${e.Name}`,void 0,{duration:3e3}),this.fetchMetadata()}})):this.createMetadataForm(e.Id)):void at.B.openDialog(this.dialog,e.MissingFeature,this.viewContainerRef,this.changeDetectorRef);this.dialog.open(ot,{autoFocus:!1,viewContainerRef:this.viewContainerRef,width:"650px"}).afterClosed().subscribe(s=>{null!=s&&this.createMetadataForm(s)})}createMetadataForm(e){const a={items:[{ContentTypeName:e,For:this.calculateItemFor()}]},s=(0,p.f)(a);this.router.navigate([`edit/${s}`],{relativeTo:this.route}),this.changeDetectorRef.markForCheck()}calculateItemFor(){var e,a;return Object.assign(Object.assign(Object.assign({Target:null!==(a=null===(e=Object.values(M.Zy.metadata).find(y=>y.targetType===this.targetType))||void 0===e?void 0:e.target)&&void 0!==a?a:this.targetType.toString(),TargetType:this.targetType},this.keyType===M.Zy.keyTypes.guid&&{Guid:this.key}),this.keyType===M.Zy.keyTypes.number&&{Number:parseInt(this.key,10)}),this.keyType===M.Zy.keyTypes.string&&{String:this.key})}fetchFor(){!this.contentTypeStaticName||this.contentItemsService.getAll(this.contentTypeStaticName).subscribe(e=>{const a=e.find(s=>s.Guid===this.key);(null==a?void 0:a.For)&&this.itemFor$.next(a.For)})}fetchMetadata(){this.metadataService.getMetadata(this.targetType,this.keyType,this.key).pipe((0,n.U)(e=>(e.Recommendations.forEach(a=>{var s;(null===(s=a.Icon)||void 0===s?void 0:s.startsWith("base64:"))&&(a.Icon=a.Icon.replace("base64:",""),a.Icon=window.atob(a.Icon))}),e)),(0,C.b)(e=>{this.metadata$.next(e.Items),this.recommendations$.next(e.Recommendations)})).subscribe()}editMetadata(e){const s=(0,p.f)({items:[{EntityId:e.Id}]});this.router.navigate([`edit/${s}`],{relativeTo:this.route})}deleteMetadata(e,a=!1){var s;if(a)this.snackBar.open("Deleting..."),this.entitiesService.delete(e._Type.Id,e.Id,!1).subscribe({next:()=>{this.snackBar.open("Deleted",null,{duration:2e3}),this.fetchMetadata()},error:()=>{this.snackBar.open("Delete failed. Please check console for more information",null,{duration:3e3})}});else{const y={entityId:e.Id,entityTitle:e.Title,message:null===(s=this.recommendations$.value.find(P=>P.Id===e._Type.Id))||void 0===s?void 0:s.DeleteWarning};this.dialog.open(R,{autoFocus:!1,data:y,viewContainerRef:this.viewContainerRef,width:"650px"}).afterClosed().subscribe(P=>{P&&this.deleteMetadata(e,!0)})}}buildGridOptions(){return Object.assign(Object.assign({},A.f),{columnDefs:[{headerName:"ID",field:"Id",width:70,headerClass:"dense",cellClass:"id-action no-padding no-outline".split(" "),sortable:!0,filter:"agNumberColumnFilter",valueGetter:a=>a.data.Id,cellRenderer:Z.m,cellRendererParams:{tooltipGetter:s=>`ID: ${s.Id}\nGUID: ${s.Guid}`}},{field:"Title",flex:2,minWidth:250,cellClass:"primary-action highlight".split(" "),sortable:!0,sort:"asc",filter:"agTextColumnFilter",valueGetter:a=>a.data.Title,onCellClicked:a=>{this.editMetadata(a.data)}},{headerName:"Content Type",field:"ContentType",flex:2,minWidth:250,cellClass:"no-outline",sortable:!0,filter:"agTextColumnFilter",valueGetter:a=>{const s=a.data;return`${s._Type.Name}${s._Type.Title!==s._Type.Name?` (${s._Type.Title})`:""}`},cellRenderer:l},{width:42,cellClass:"secondary-action no-padding".split(" "),pinned:"right",cellRenderer:b,cellRendererParams:(()=>({onDelete:s=>this.deleteMetadata(s)}))()}]})}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(B.F0),t.Y36(B.gz),t.Y36(u.so),t.Y36(x.Do),t.Y36(it.ux),t.Y36(d.g),t.Y36(_.l),t.Y36(u.uw),t.Y36(t.s_b),t.Y36(t.sBO))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-metadata"]],features:[t.qOj],decls:2,vars:3,consts:[[4,"ngIf"],[1,"nav-component-wrapper"],["mat-dialog-title",""],[1,"dialog-title-box"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"dialog-description"],[1,"grid-wrapper"],[1,"ag-theme-material",3,"rowData","gridOptions"],[1,"grid-more-actions-box"],["mat-fab","","mat-elevation-z24","","class","grid-fab","tippy","Create a new metadata for this item",3,"click",4,"ngIf"],["class","grid-fab",3,"ngClass","openChange",4,"ngIf"],["mat-fab","","mat-elevation-z24","","tippy","Create a new metadata for this item",1,"grid-fab",3,"click"],[1,"grid-fab",3,"ngClass","openChange"],[3,"spin"],["mat-fab",""],[1,"spin180"],["mat-mini-fab","","label","Other Content Type",3,"click"],["mat-mini-fab","",3,"click",4,"ngFor","ngForOf"],["mat-mini-fab","",3,"click"],[4,"ngIf","ngIfThen","ngIfElse"],["svgIcon",""],["matIcon",""],["matBadgeColor","accent","matBadgeSize","small","matBadge","\u{1f48e}","matBadgePosition","below after",3,"innerHTML","matBadgeHidden"]],template:function(e,a){1&e&&(t.YNc(0,xt,18,7,"ng-container",0),t.ALo(1,"async")),2&e&&t.Q6J("ngIf",t.lcZ(1,1,a.templateVars$))},directives:[f.O5,u.uh,D.lW,S.$,m.Hw,B.lC,st.N8,Y.W7,f.mk,Y.YI,Y.Lp,f.sg,rt.k],pipes:[f.Ov,$.z],styles:["[_nghost-%COMP%]     .mat-button-wrapper div svg *:not([fill]){fill:#fff}"]}),o})()},8352:(E,T,i)=>{i.d(T,{Y:()=>M});var r=i(3184),h=i(6362),n=i(4770);function C(p,u){1&p&&r.GkF(0)}function _(p,u){if(1&p&&(r.TgZ(0,"mat-hint"),r.YNc(1,C,1,0,"ng-container",3),r.qZA()),2&p){r.oxw();const t=r.MAs(4);r.xp6(1),r.Q6J("ngTemplateOutlet",t)}}function d(p,u){1&p&&r.GkF(0)}function x(p,u){if(1&p&&(r.TgZ(0,"mat-error"),r.YNc(1,d,1,0,"ng-container",3),r.qZA()),2&p){r.oxw();const t=r.MAs(4);r.xp6(1),r.Q6J("ngTemplateOutlet",t)}}function v(p,u){1&p&&r.Hsn(0)}const Z=function(p){return{"hint-box__short":p}},A=["*"];let M=(()=>{class p{constructor(){this.isError=!1,this.isShort=!0}toggleIsShort(){this.isShort=!this.isShort}}return p.\u0275fac=function(t){return new(t||p)},p.\u0275cmp=r.Xpm({type:p,selectors:[["app-field-hint"]],inputs:{isError:"isError"},ngContentSelectors:A,decls:5,vars:6,consts:[[1,"hint-box",3,"ngClass","ngSwitch","click"],[4,"ngSwitchCase"],["content",""],[4,"ngTemplateOutlet"]],template:function(t,f){1&t&&(r.F$t(),r.TgZ(0,"div",0),r.NdJ("click",function(){return f.toggleIsShort()}),r.YNc(1,_,2,1,"mat-hint",1),r.YNc(2,x,2,1,"mat-error",1),r.qZA(),r.YNc(3,v,1,0,"ng-template",null,2,r.W1O)),2&t&&(r.Q6J("ngClass",r.VKq(4,Z,f.isShort))("ngSwitch",f.isError),r.xp6(1),r.Q6J("ngSwitchCase",!1),r.xp6(1),r.Q6J("ngSwitchCase",!0))},directives:[h.mk,h.RF,h.n9,n.bx,h.tP,n.TO],styles:[".hint-box[_ngcontent-%COMP%]{margin-top:4px}.hint-box[_ngcontent-%COMP%]   .mat-hint[_ngcontent-%COMP%], .hint-box[_ngcontent-%COMP%]   .mat-error[_ngcontent-%COMP%]{font-size:12px;display:block}.hint-box__short[_ngcontent-%COMP%]   .mat-hint[_ngcontent-%COMP%], .hint-box__short[_ngcontent-%COMP%]   .mat-error[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]}),p})()},7294:(E,T,i)=>{i.d(T,{E:()=>h});var r=i(3184);let h=(()=>{class n{onClick(_){_.stopPropagation()}}return n.\u0275fac=function(_){return new(_||n)},n.\u0275dir=r.lG2({type:n,selectors:[["","appClickStopPropagation",""]],hostBindings:function(_,d){1&_&&r.NdJ("click",function(v){return d.onClick(v)})}}),n})()},9934:(E,T,i)=>{function r(n){return new Promise((C,_)=>{const d=new FileReader;d.readAsDataURL(n),d.onload=()=>{C(d.result.split(",")[1])},d.onerror=x=>{_(x)}})}function h(n){return new Promise((C,_)=>{const d=new FileReader;d.readAsText(n),d.onload=()=>{C(d.result)},d.onerror=x=>{_(x)}})}i.d(T,{B:()=>h,s:()=>r})}}]);
//# sourceMappingURL=https://sources.2sxc.org/15.02.00/ng-edit/projects_eav-ui_src_app_metadata_metadata_component_ts.f956733cd6dc296b.js.map