"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["default-projects_eav-ui_src_app_create-file-dialog_index_ts"],{7207:(B,w,a)=>{a.d(w,{t:()=>S});var c=a(635),t=a(5368),I=a(3184),D=a(8784),F=a(2425);const b="admin/AppFiles/asset";let S=(()=>{class _{constructor(i,p,d){this.http=i,this.context=p,this.dnnContext=d}get(i,p,d){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(b),{params:Object.assign({appId:this.context.appId,global:p},this.templateIdOrPath(i,p,d))}).pipe((0,c.U)(m=>{if("auto"===m.Type.toLocaleLowerCase())switch(m.Extension.toLocaleLowerCase()){case".cs":case".cshtml":m.Type="Razor";break;case".html":case".css":case".js":m.Type="Token"}return m}))}save(i,p,d,m){return this.http.post(this.dnnContext.$2sxc.http.apiUrl(b),d,{params:Object.assign({appId:this.context.appId,global:p},this.templateIdOrPath(i,p,m))})}getAll(i){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/AppFiles"),{params:Object.assign({appId:this.context.appId},i&&{mask:i})}).pipe((0,c.U)(({Files:p})=>(p.forEach(d=>{var m;null!==(m=d.Shared)&&void 0!==m||(d.Shared=!1)}),p)))}getWebApis(){return this.getAll("*Controller.cs").pipe((0,c.U)(i=>i.map(d=>{const m=d.Path.lastIndexOf("/"),A=d.Path.lastIndexOf("."),Z=d.Path.substring(0,m),T=d.Path.substring(m+1,A);return{path:d.Path,folder:Z,name:T,isShared:d.Shared}})))}getWebApiDetails(i){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/ApiExplorer/inspect"),{params:{appId:this.context.appId,zoneId:this.context.zoneId,path:i}})}getPredefinedTemplates(i,p){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/GetTemplates"),{params:Object.assign(Object.assign({},i&&{purpose:i}),p&&{type:p})})}getPreview(i,p,d){return this.http.get(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/preview"),{params:{appId:this.context.appId,path:i,templateKey:d,global:p}})}create(i,p,d){return this.http.post(this.dnnContext.$2sxc.http.apiUrl("admin/AppFiles/create"),{},{params:{appId:this.context.appId,global:p,purpose:"auto",path:i,templateKey:d}})}templateIdOrPath(i,p,d){var m;if(/^[0-9]*$/g.test(i)){const A=null===(m=d.find(Z=>{var T;return(null===(T=Z.EntityId)||void 0===T?void 0:T.toString())===i&&Z.IsShared===p}))||void 0===m?void 0:m.Path;return Object.assign({templateId:i},null!=A&&{path:A})}return{path:i}}}return _.\u0275fac=function(i){return new(i||_)(I.LFG(D.eN),I.LFG(t._),I.LFG(F._y))},_.\u0275prov=I.Yz7({token:_,factory:_.\u0275fac}),_})()},7383:(B,w,a)=>{a.d(w,{UH:()=>st,qH:()=>pt,i6:()=>$});var c=a(587),t=a(3184),I=a(5758),D=a(4770),F=a(1434),M=a(1130),b=a(6362),N=a(8352),U=a(7317);function E(o,u){1&o&&(t.TgZ(0,"app-field-hint",11),t._uU(1," This field is required "),t.qZA()),2&o&&t.Q6J("isError",!0)}let $=(()=>{class o{constructor(e){this.dialogRef=e,this.hostClass="dialog-component"}ngOnInit(){this.form=new c.cw({isShared:new c.NI(null,c.kI.required)})}closeDialog(e){this.dialogRef.close(e)}confirm(){const e=this.form.getRawValue();this.closeDialog(e.isShared)}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(I.so))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-file-location-dialog"]],hostVars:1,hostBindings:function(e,n){2&e&&t.Ikx("className",n.hostClass)},decls:19,vars:5,consts:[["mat-dialog-title",""],[1,"dialog-title-box"],[1,"dialog-form",3,"formGroup"],[1,"dialog-form-content","fancy-scrollbar-light"],["appearance","standard","color","accent"],["formControlName","isShared"],[3,"value"],[3,"isError",4,"ngIf"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"disabled","click"],[3,"isError"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0)(1,"div",1),t._uU(2,"New file location"),t.qZA()(),t.TgZ(3,"form",2)(4,"div",3)(5,"mat-form-field",4)(6,"mat-label"),t._uU(7,"Location"),t.qZA(),t.TgZ(8,"mat-select",5)(9,"mat-option",6),t._uU(10,"App"),t.qZA(),t.TgZ(11,"mat-option",6),t._uU(12,"Shared (global)"),t.qZA()()(),t.YNc(13,E,2,1,"app-field-hint",7),t.TgZ(14,"div",8)(15,"button",9),t.NdJ("click",function(){return n.closeDialog()}),t._uU(16,"Cancel"),t.qZA(),t.TgZ(17,"button",10),t.NdJ("click",function(){return n.confirm()}),t._uU(18," Confirm "),t.qZA()()()()),2&e&&(t.xp6(3),t.Q6J("formGroup",n.form),t.xp6(6),t.Q6J("value",!1),t.xp6(2),t.Q6J("value",!0),t.xp6(2),t.Q6J("ngIf",n.form.controls.isShared.touched&&(null==n.form.controls.isShared.errors?null:n.form.controls.isShared.errors.required)),t.xp6(4),t.Q6J("disabled",!n.form.valid))},directives:[c._Y,c.JL,c.sg,D.KE,D.hX,F.gD,c.JJ,c.u,M.ey,b.O5,N.Y,U.lW],styles:[""]}),o})();var S=a(7714),_=a(6317),y=a(6562),i=a(4874),p=a(8977),d=a(635),m=a(9337),A=a(6936),Z=a(1944),T=a(3945),L=a(4987);const Q={leading:!0,trailing:!1};var V=a(8947);var W=a(2673),q=a(745),G=a(1640),K=a(7207),H=a(2423),J=a(4683);let X=(()=>{class o{constructor(e,n){this.matInput=e,this.elementRef=n,this.autofocusSelectValue=!1}ngOnInit(){setTimeout(()=>{this.matInput.focus(),this.toBoolean(this.autofocusSelectValue)&&this.elementRef.nativeElement.setSelectionRange(0,this.matInput.value.length)})}toBoolean(e){if("boolean"==typeof e)return e;if("string"==typeof e){const n=e.toLocaleLowerCase();return"true"===n||"false"!==n&&void 0}return null==e?e:void 0}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(J.Nt),t.Y36(t.SBq))},o.\u0275dir=t.lG2({type:o,selectors:[["","appMatInputAutofocus",""]],inputs:{autofocusSelectValue:"autofocusSelectValue"}}),o})();var Y=a(4742);function k(o,u){if(1&o&&(t.TgZ(0,"mat-option",20),t._uU(1),t.qZA()),2&o){const e=u.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function tt(o,u){if(1&o&&(t.TgZ(0,"mat-option",20),t._uU(1),t.qZA()),2&o){const e=u.$implicit;t.Q6J("value",e),t.xp6(1),t.hij(" ",e," ")}}function et(o,u){if(1&o&&(t.TgZ(0,"mat-option",20),t._uU(1),t.qZA()),2&o){const e=u.$implicit;t.Q6J("value",e.Key),t.xp6(1),t.hij(" ",e.Name," ")}}function ot(o,u){1&o&&(t.TgZ(0,"app-field-hint",21),t._uU(1," This field is required "),t.qZA()),2&o&&t.Q6J("isError",!0)}function nt(o,u){1&o&&(t.ynx(0),t._UZ(1,"mat-spinner",22)(2,"div",23),t.BQk())}const j=function(o){return{disabled:o}};function at(o,u){if(1&o&&(t.ynx(0),t.TgZ(1,"div",24)(2,"label",25),t._uU(3,"Preview"),t.qZA()(),t.TgZ(4,"pre",26),t._uU(5),t.qZA(),t.BQk()),2&o){const e=t.oxw().ngIf;t.xp6(2),t.Q6J("ngClass",t.VKq(3,j,e.loadingPreview)),t.xp6(2),t.Q6J("ngClass",t.VKq(5,j,e.loadingPreview)),t.xp6(1),t.Oqu(e.preview)}}function it(o,u){if(1&o&&(t.TgZ(0,"div",27),t._uU(1),t.qZA()),2&o){const e=t.oxw().ngIf;t.xp6(1),t.hij(" ",e.previewError," ")}}function lt(o,u){if(1&o){const e=t.EpF();t.ynx(0),t.TgZ(1,"div",1)(2,"div",2)(3,"span"),t._uU(4,"Create"),t.qZA(),t.TgZ(5,"span",3),t._uU(6),t.qZA()()(),t.TgZ(7,"form",4)(8,"div",5)(9,"div",6)(10,"div",7)(11,"mat-form-field",8)(12,"mat-label"),t._uU(13,"Platform"),t.qZA(),t.TgZ(14,"mat-select",9),t.YNc(15,k,2,2,"mat-option",10),t.qZA()()(),t.TgZ(16,"div",7)(17,"mat-form-field",8)(18,"mat-label"),t._uU(19,"Purpose"),t.qZA(),t.TgZ(20,"mat-select",11),t.YNc(21,tt,2,2,"mat-option",10),t.qZA()()()(),t.TgZ(22,"div",12)(23,"mat-form-field",8)(24,"mat-label"),t._uU(25,"Template"),t.qZA(),t.TgZ(26,"mat-select",13),t.YNc(27,et,2,2,"mat-option",10),t.qZA()()(),t.TgZ(28,"div",12)(29,"mat-form-field",8)(30,"mat-label"),t._uU(31,"Name"),t.qZA(),t._UZ(32,"input",14),t.qZA(),t.YNc(33,ot,2,1,"app-field-hint",15),t.qZA()(),t.TgZ(34,"div",16),t.YNc(35,nt,3,0,"ng-container",0),t.TgZ(36,"button",17),t.NdJ("click",function(){return t.CHM(e),t.oxw().closeDialog()}),t._uU(37,"Cancel"),t.qZA(),t.TgZ(38,"button",18),t.NdJ("click",function(){return t.CHM(e),t.oxw().confirm()}),t._uU(39," Create "),t.qZA()(),t.YNc(40,at,6,7,"ng-container",0),t.YNc(41,it,2,1,"div",19),t.qZA(),t.BQk()}if(2&o){const e=u.ngIf,n=t.oxw();t.xp6(6),t.Oqu(n.controls.finalName.value||(n.controls.folder.value?n.controls.folder.value.trim()+"/":"")),t.xp6(1),t.Q6J("formGroup",n.form),t.xp6(8),t.Q6J("ngForOf",e.platforms),t.xp6(6),t.Q6J("ngForOf",e.purposes),t.xp6(6),t.Q6J("ngForOf",e.templates),t.xp6(6),t.Q6J("ngIf",n.controls.name.touched&&(null==n.controls.name.errors?null:n.controls.name.errors.required)),t.xp6(2),t.Q6J("ngIf",e.loadingPreview),t.xp6(3),t.Q6J("disabled",!n.form.valid||e.loadingPreview||!e.previewValid),t.xp6(2),t.Q6J("ngIf",e.preview),t.xp6(1),t.Q6J("ngIf",!e.loadingPreview&&e.previewError)}}let st=(()=>{class o{constructor(e,n,v){this.dialogData=e,this.dialogRef=n,this.sourceService=v,this.hostClass="dialog-component",this.all="All"}ngOnInit(){this.subscription=new S.w0,this.templates$=new _.X([]),this.loadingPreview$=new _.X(!1),this.buildForm(),this.fetchTemplates(),this.buildTemplateVars()}ngOnDestroy(){this.templates$.complete(),this.loadingPreview$.complete(),this.subscription.unsubscribe()}closeDialog(e){this.dialogRef.close(e)}confirm(){const e=this.form.getRawValue();this.closeDialog({name:e.finalName,templateKey:e.templateKey})}fetchTemplates(){this.sourceService.getPredefinedTemplates(this.dialogData.purpose,this.dialogData.type).subscribe(e=>{this.controls.templateKey.value!==e.Default&&this.controls.templateKey.patchValue(e.Default),this.templates$.next(e.Templates)})}buildForm(){var e,n,v;this.form=new c.cw({platform:new c.NI(this.all),purpose:new c.NI({value:null!==(e=this.dialogData.purpose)&&void 0!==e?e:this.all,disabled:null!=this.dialogData.purpose}),templateKey:new c.NI(null,c.kI.required),name:new c.NI(null!==(n=this.dialogData.name)&&void 0!==n?n:null,c.kI.required),finalName:new c.NI({value:null,disabled:!0}),folder:new c.NI({value:null!==(v=this.dialogData.folder)&&void 0!==v?v:"",disabled:!0})}),this.controls=this.form.controls,this.subscription.add((0,y.a)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,i.O)(this.controls.templateKey.value),(0,p.x)())]).subscribe(([O,f])=>{var s;const l=O.find(h=>h.Key===f),r=this.dialogData.name?this.controls.name.value||this.dialogData.name:null!==(s=null==l?void 0:l.SuggestedFileName)&&void 0!==s?s:null;this.controls.name.value!==r&&this.controls.name.patchValue(r)})),this.subscription.add((0,y.a)([this.templates$,this.controls.templateKey.valueChanges.pipe((0,i.O)(this.controls.templateKey.value),(0,p.x)()),this.controls.name.valueChanges.pipe((0,i.O)(this.controls.name.value),(0,p.x)()),this.controls.folder.valueChanges.pipe((0,i.O)(this.controls.folder.value),(0,p.x)())]).subscribe(([O,f,s,l])=>{var r,h,x;const g=O.find(C=>C.Key===f);let P=null;s&&(l=l.trim(),s=H.vl.sanitizePath(s.trim()),P=`${l?`${l}/`:""}${s=`${null!==(r=null==g?void 0:g.Prefix)&&void 0!==r?r:""}${s}${null!==(h=null==g?void 0:g.Suffix)&&void 0!==h?h:""}${null!==(x=null==g?void 0:g.Extension)&&void 0!==x?x:""}`}`.replace(/\/{2,}/g,"/")),this.controls.finalName.value!==P&&this.controls.finalName.patchValue(P)}))}buildTemplateVars(){const e=this.templates$.pipe((0,d.U)(f=>{const s={[this.all]:this.all};return f.forEach(l=>{var r;null===(r=l.Platforms)||void 0===r||r.forEach(h=>{s[h]=h})}),Object.keys(s)})),n=this.templates$.pipe((0,d.U)(f=>{const s={[this.all]:this.all};return f.forEach(l=>{s[l.Purpose]=l.Purpose}),Object.keys(s)})),v=(0,y.a)([this.templates$,this.controls.platform.valueChanges.pipe((0,i.O)(this.controls.platform.value),(0,p.x)()),this.controls.purpose.valueChanges.pipe((0,i.O)(this.controls.purpose.value),(0,p.x)())]).pipe((0,d.U)(([f,s,l])=>f.filter(h=>{var x,g;return(s===this.all||null!==(g=null===(x=h.Platforms)||void 0===x?void 0:x.includes(s))&&void 0!==g&&g)&&(l===this.all||h.Purpose===l)})),(0,m.b)(f=>{var s,l;if(!f.some(r=>r.Key===this.controls.templateKey.value)){const r=null!==(l=null===(s=f[0])||void 0===s?void 0:s.Key)&&void 0!==l?l:null;this.controls.templateKey.value!==r&&this.controls.templateKey.patchValue(r)}})),O=(0,y.a)([this.controls.finalName.valueChanges.pipe((0,i.O)(this.controls.finalName.value),(0,p.x)()),this.controls.templateKey.valueChanges.pipe((0,i.O)(this.controls.templateKey.value),(0,p.x)())]).pipe(function z(o,u=A.z,e=Q){const n=(0,V.H)(o,u);return function R(o,u=Q){return(0,Z.e)((e,n)=>{const{leading:v,trailing:O}=u;let f=!1,s=null,l=null,r=!1;const h=()=>{null==l||l.unsubscribe(),l=null,O&&(P(),r&&n.complete())},x=()=>{l=null,r&&n.complete()},g=C=>l=(0,L.Xf)(o(C)).subscribe(new T.Q(n,h,x)),P=()=>{if(f){f=!1;const C=s;s=null,n.next(C),!r&&g(C)}};e.subscribe(new T.Q(n,C=>{f=!0,s=C,(!l||l.closed)&&(v?P():g(C))},()=>{r=!0,(!(O&&f&&l)||l.closed)&&n.complete()}))})}(()=>n,e)}(100,A.z,{leading:!0,trailing:!0}),(0,m.b)(()=>{this.loadingPreview$.next(!0)}),(0,W.w)(([f,s])=>f&&s?(0,G.D)([this.sourceService.getPreview(f,this.dialogData.global,s),(0,V.H)(500)]).pipe((0,d.U)(([l])=>l)):(0,q.of)(void 0)),(0,m.b)(()=>{this.loadingPreview$.next(!1)}));this.templateVars$=(0,y.a)([e,n,v,O,this.loadingPreview$]).pipe((0,d.U)(([f,s,l,r,h])=>{var x;return{platforms:f,purposes:s,templates:l,loadingPreview:h,preview:null==r?void 0:r.Preview,previewValid:null!==(x=null==r?void 0:r.IsValid)&&void 0!==x&&x,previewError:null==r?void 0:r.Error}}))}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(I.WI),t.Y36(I.so),t.Y36(K.t))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-create-file-dialog"]],hostVars:1,hostBindings:function(e,n){2&e&&t.Ikx("className",n.hostClass)},decls:2,vars:3,consts:[[4,"ngIf"],["mat-dialog-title",""],[1,"dialog-title-box","hide-scrollbar"],[1,"file-name"],[1,"dialog-form",3,"formGroup"],[1,"dialog-form-content","fancy-scrollbar-light"],[1,"field-container","multiple"],[1,"multiple-field"],["appearance","standard","color","accent"],["formControlName","platform"],[3,"value",4,"ngFor","ngForOf"],["formControlName","purpose"],[1,"field-container"],["formControlName","templateKey"],["matInput","","type","text","formControlName","name","required","","appMatInputAutofocus","","autofocusSelectValue","true"],[3,"isError",4,"ngIf"],[1,"dialog-form-actions"],["mat-raised-button","","type","button",3,"click"],["mat-raised-button","","type","button","color","accent",3,"disabled","click"],["class","preview-error",4,"ngIf"],[3,"value"],[3,"isError"],["mode","indeterminate","diameter","20","color","accent"],[1,"spacer"],[1,"preview-label-box"],[1,"preview-label",3,"ngClass"],[1,"fancy-scrollbar-light",3,"ngClass"],[1,"preview-error"]],template:function(e,n){1&e&&(t.YNc(0,lt,42,10,"ng-container",0),t.ALo(1,"async")),2&e&&t.Q6J("ngIf",t.lcZ(1,1,n.templateVars$))},directives:[b.O5,c._Y,c.JL,c.sg,D.KE,D.hX,F.gD,c.JJ,c.u,b.sg,M.ey,J.Nt,c.Fj,c.Q7,X,N.Y,Y.Ou,U.lW,b.mk],pipes:[b.Ov],styles:[".dialog-title-box[_ngcontent-%COMP%]{justify-content:flex-start;align-items:baseline;line-height:normal;white-space:nowrap;overflow-x:auto}.dialog-title-box[_ngcontent-%COMP%]   .file-name[_ngcontent-%COMP%]{font-size:20px;margin-left:8px;background-color:#d3d3d3}.field-container[_ngcontent-%COMP%]:not(:first-of-type){margin-top:8px}.field-container.multiple[_ngcontent-%COMP%]{display:flex}.field-container.multiple[_ngcontent-%COMP%]   .multiple-field[_ngcontent-%COMP%]{flex:1}.field-container.multiple[_ngcontent-%COMP%]   .multiple-field[_ngcontent-%COMP%]:not(:first-of-type){margin-left:8px}.dialog-form-content[_ngcontent-%COMP%], .dialog-form-actions[_ngcontent-%COMP%]{flex-shrink:0}pre[_ngcontent-%COMP%]{flex-grow:1;flex-shrink:1;font-family:monospace}pre.disabled[_ngcontent-%COMP%]{color:#1d273d3d}.preview-label-box[_ngcontent-%COMP%]{position:relative}.preview-label-box[_ngcontent-%COMP%]   .preview-label[_ngcontent-%COMP%]{position:absolute;top:-20px;left:0px;font-size:12px;color:#0009;pointer-events:none}.preview-label-box[_ngcontent-%COMP%]   .preview-label.disabled[_ngcontent-%COMP%]{color:#1d273d70}.preview-error[_ngcontent-%COMP%]{margin-bottom:10px;font-size:14px;color:red}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}"]}),o})();var rt=a(5368),ct=a(3135);let pt=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({providers:[rt._,K.t],imports:[[b.ez,ct.q,U.ot,F.LD,c.UX,D.lN,J.c,Y.Cq]]}),o})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/14.12.03/ng-edit/default-projects_eav-ui_src_app_create-file-dialog_index_ts.46c57deaf94de9bc.js.map