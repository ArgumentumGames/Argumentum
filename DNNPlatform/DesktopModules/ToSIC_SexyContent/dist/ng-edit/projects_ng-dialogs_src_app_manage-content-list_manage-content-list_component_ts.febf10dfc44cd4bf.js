"use strict";(self.webpackChunkng_dialogs=self.webpackChunkng_dialogs||[]).push([["projects_ng-dialogs_src_app_manage-content-list_manage-content-list_component_ts"],{7329:(W,h,i)=>{i.r(h),i.d(h,{ManageContentListComponent:()=>R});var l=i(6554),c=i(2977),u=i(6317),M=i(6562),m=i(635),E=i(7714),x=i(116),O=i(4874),I=i(679),v=i(5137),T=i(4830),t=i(3184),C=i(5758),P=i(2528),p=i(6362),D=i(7317),L=i(785),A=i(5590),U=i(2634);function b(o,s){if(1&o){const n=t.EpF();t.ynx(0),t.TgZ(1,"span"),t._uU(2),t.qZA(),t.TgZ(3,"button",12),t.NdJ("click",function(){return t.CHM(n),t.oxw(3).editHeader()}),t.TgZ(4,"mat-icon"),t._uU(5,"edit"),t.qZA()(),t.BQk()}if(2&o){const n=t.oxw(2).ngIf;t.xp6(2),t.Oqu(n.header.Title)}}function B(o,s){1&o&&(t.ynx(0),t._uU(1,"(this list has no header)"),t.BQk())}function Z(o,s){if(1&o&&(t.ynx(0),t.TgZ(1,"p",11),t._uU(2," You can manage the list header here (if it is defined): "),t.qZA(),t.TgZ(3,"p",11),t.YNc(4,b,6,1,"ng-container",7),t.YNc(5,B,2,0,"ng-container",7),t.qZA(),t.BQk()),2&o){const n=t.oxw().ngIf;t.xp6(4),t.Q6J("ngIf",n.header.Type),t.xp6(1),t.Q6J("ngIf",!n.header.Type)}}function y(o,s){if(1&o){const n=t.EpF();t.TgZ(0,"div")(1,"button",17),t.NdJ("click",function(){t.CHM(n);const a=t.oxw().$implicit;return t.oxw(2).editItem(a.Id)}),t.TgZ(2,"mat-icon"),t._uU(3,"edit"),t.qZA()()()}}function $(o,s){if(1&o&&(t.TgZ(0,"div",13)(1,"div",14)(2,"mat-icon",15),t._uU(3,"drag_handle"),t.qZA(),t.TgZ(4,"span",16),t._uU(5),t.qZA()(),t.YNc(6,y,4,0,"div",7),t.qZA()),2&o){const n=s.$implicit;t.xp6(4),t.hYB("tippy","",n.Title," (",n.Id,")"),t.xp6(1),t.AsE(" ",n.Title," (",n.Id,") "),t.xp6(1),t.Q6J("ngIf",0!==n.Id)}}function k(o,s){if(1&o){const n=t.EpF();t.TgZ(0,"div",6),t.YNc(1,Z,6,2,"ng-container",7),t.TgZ(2,"p",8),t._uU(3,"Sort the items by dragging as you need, then save:"),t.qZA(),t.TgZ(4,"div",9),t.NdJ("cdkDropListDropped",function(a){return t.CHM(n),t.oxw().drop(a)}),t.YNc(5,$,7,5,"div",10),t.qZA()()}if(2&o){const n=s.ngIf,e=t.oxw();t.xp6(1),t.Q6J("ngIf",n.header),t.xp6(4),t.Q6J("ngForOf",n.items)("ngForTrackBy",e.trackByFn)}}let R=(()=>{class o{constructor(n,e,a,r,d){this.dialogRef=n,this.contentGroupService=e,this.route=a,this.router=r,this.snackBar=d,this.hostClass="dialog-component",this.items$=new u.X(null),this.header$=new u.X(null),this.templateVars$=(0,M.a)([this.items$,this.header$]).pipe((0,m.U)(([g,_])=>({items:g,header:_}))),this.contentGroup={id:null,guid:this.route.snapshot.paramMap.get("guid"),part:this.route.snapshot.paramMap.get("part"),index:parseInt(this.route.snapshot.paramMap.get("index"),10)},this.reordered=!1,this.subscription=new E.w0}ngOnInit(){this.fetchList(),this.fetchHeader(),this.refreshOnChildClosed()}ngOnDestroy(){this.items$.complete(),this.header$.complete(),this.subscription.unsubscribe()}closeDialog(){this.dialogRef.close()}saveList(){this.snackBar.open("Saving..."),this.contentGroupService.saveList(this.contentGroup,this.items$.value).subscribe(n=>{this.snackBar.open("Saved"),this.closeDialog()})}editHeader(){const e=(0,v.f)({items:[{Group:{Guid:this.contentGroup.guid,Index:0,Part:"listcontent",Add:0===this.header$.value.Id}},{Group:{Guid:this.contentGroup.guid,Index:0,Part:"listpresentation",Add:0===this.header$.value.Id}}]});this.router.navigate([`edit/${e}`],{relativeTo:this.route})}editItem(n){const a=(0,v.f)({items:[{EntityId:n}]});this.router.navigate([`edit/${a}`],{relativeTo:this.route})}drop(n){const e=[...this.items$.value];(0,l.bA)(e,n.previousIndex,n.currentIndex),this.items$.next(e),this.reordered=!0}trackByFn(n,e){return`${e.Index}+${e.Id}`}fetchList(){this.contentGroupService.getList(this.contentGroup).subscribe(n=>{if(this.reordered){const e=this.items$.value.map(r=>r.Id);if(this.items$.value.length!==n.length||n.some(r=>!e.includes(r.Id)))this.snackBar.open("List was changed from somewhere else. Order of items is reset",null,{duration:5e3});else{const r=this.items$.value.map(d=>d.Index);n.sort((d,g)=>{const _=r.indexOf(d.Index),f=r.indexOf(g.Index);return-1===_||-1===f?0:_-f})}}this.items$.next(n)})}fetchHeader(){this.contentGroupService.getHeader(this.contentGroup).subscribe(n=>{this.header$.next(n)})}refreshOnChildClosed(){this.subscription.add(this.router.events.pipe((0,x.h)(n=>n instanceof c.m2),(0,O.O)(!!this.route.snapshot.firstChild),(0,m.U)(()=>!!this.route.snapshot.firstChild),(0,I.G)(),(0,x.h)(([n,e])=>n&&!e)).subscribe(()=>{this.fetchList(),this.fetchHeader()}))}}return o.\u0275fac=function(n){return new(n||o)(t.Y36(C.so),t.Y36(T.e),t.Y36(c.gz),t.Y36(c.F0),t.Y36(P.ux))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-manage-content-list"]],hostVars:1,hostBindings:function(n,e){2&n&&t.Ikx("className",e.hostClass)},decls:11,vars:3,consts:[["mat-dialog-title",""],[1,"dialog-title-box"],["class","dialog-component-content fancy-scrollbar-light",4,"ngIf"],[1,"dialog-component-actions"],["mat-raised-button","",3,"click"],["mat-raised-button","","color","accent",3,"click"],[1,"dialog-component-content","fancy-scrollbar-light"],[4,"ngIf"],[1,"dialog-description","sort-title"],["cdkDropList","",1,"dnd-list",3,"cdkDropListDropped"],["class","dnd-item","cdkDrag","",4,"ngFor","ngForOf","ngForTrackBy"],[1,"dialog-description"],["mat-icon-button","","tippy","Edit header",3,"click"],["cdkDrag","",1,"dnd-item"],[1,"dnd-item__title"],["tippy","Drag to reorder the list",1,"dnd-item__title-icon"],[1,"dnd-item__title-text",3,"tippy"],["mat-icon-button","","tippy","Edit item","appMousedownStopPropagation","",3,"click"]],template:function(n,e){1&n&&(t.TgZ(0,"div",0)(1,"div",1),t._uU(2,"Manage content-item lists"),t.qZA()(),t._UZ(3,"router-outlet"),t.YNc(4,k,6,3,"div",2),t.ALo(5,"async"),t.TgZ(6,"div",3)(7,"button",4),t.NdJ("click",function(){return e.closeDialog()}),t._uU(8,"Cancel"),t.qZA(),t.TgZ(9,"button",5),t.NdJ("click",function(){return e.saveList()}),t._uU(10,"Save"),t.qZA()()),2&n&&(t.xp6(4),t.Q6J("ngIf",t.lcZ(5,1,e.templateVars$)))},directives:[C.uh,c.lC,p.O5,D.lW,L.$,A.Hw,l.Wj,p.sg,l.Zt,U.d],pipes:[p.Ov],styles:[".sort-title[_ngcontent-%COMP%]{padding-top:16px}.dnd-list[_ngcontent-%COMP%]{margin:16px 0;border:1px solid #ccc;border-radius:4px;overflow:hidden}.dnd-item[_ngcontent-%COMP%]{cursor:move;height:40px;border-bottom:1px solid #ccc;padding:0 8px;display:flex;align-items:center;justify-content:space-between;background:white;box-sizing:border-box;font-size:14px}.dnd-item[_ngcontent-%COMP%]:last-child{border:none}.dnd-item__title[_ngcontent-%COMP%]{display:flex;align-items:center;overflow:hidden}.dnd-item__title-icon[_ngcontent-%COMP%]{margin-right:8px;opacity:.4}.dnd-item__title-text[_ngcontent-%COMP%]{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.dnd-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .dnd-item[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"]}),o})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/13.06.00/ng-edit/projects_ng-dialogs_src_app_manage-content-list_manage-content-list_component_ts.febf10dfc44cd4bf.js.map