(window.webpackJsonp=window.webpackJsonp||[]).push([[61,52],{S36y:function(t,e,n){"use strict";n.d(e,"b",(function(){return l})),n.d(e,"a",(function(){return u}));var i=n("D57K"),o=n("YtkY"),r=n("EM62"),a=n("vobO"),c=n("Iv+g"),s=n("B5/E"),l="admin/type/",u=function(){function t(t,e,n){this.http=t,this.context=e,this.dnnContext=n}return t.prototype.apiUrl=function(t){return this.dnnContext.$2sxc.http.apiUrl(t)},t.prototype.retrieveContentType=function(t){return this.http.get(this.apiUrl(l+"get"),{params:{appId:this.context.appId.toString(),contentTypeId:t}})},t.prototype.retrieveContentTypes=function(t){return this.http.get(this.apiUrl(l+"list"),{params:{appId:this.context.appId.toString(),scope:t}})},t.prototype.getScopes=function(){return this.http.get(this.apiUrl(l+"scopes"),{params:{appId:this.context.appId.toString()}}).pipe(Object(o.a)((function(t){return Object.keys(t).map((function(e){return{name:t[e],value:e}}))})))},t.prototype.save=function(t){return this.http.post(this.apiUrl(l+"save"),t,{params:{appid:this.context.appId.toString()}})},t.prototype.delete=function(t){return this.http.delete(this.apiUrl(l+"delete"),{params:{appid:this.context.appId.toString(),staticName:t.StaticName}})},t.prototype.import=function(t){var e,n,o=new FormData;try{for(var r=Object(i.h)(t),a=r.next();!a.done;a=r.next())o.append("File",a.value)}catch(c){e={error:c}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return this.http.post(this.apiUrl(l+"import"),o,{params:{appId:this.context.appId.toString(),zoneId:this.context.zoneId.toString()}})},t.prototype.createGhost=function(t){return this.http.post(this.apiUrl(l+"addghost"),null,{params:{appid:this.context.appId.toString(),sourceStaticName:t}})},t.\u0275fac=function(e){return new(e||t)(r.Wb(a.b),r.Wb(c.a),r.Wb(s.a))},t.\u0275prov=r.Ib({token:t,factory:t.\u0275fac}),t}()},TpGC:function(t,e,n){"use strict";n.r(e),n.d(e,"VisualQueryModule",(function(){return Pt}));var i=n("2kYt"),o=n("PBFl"),r=n("OZ4H"),a=n("bFHC"),c=n("k8N0"),s=n("W1gw"),l=n("Y2X+"),u=n("S36y"),p=n("ykZ8"),d=n("Iv+g"),f=n("O6Xb"),b=n("D57K"),h=n("YtkY"),g=n("eVkS"),v=n("o9tz"),y=n("EM62"),m=n("vobO"),S=n("B5/E"),O=function(){function t(t,e,n){this.http=t,this.context=e,this.dnnContext=n}return t.prototype.fetchPipeline=function(t){var e=this;return this.http.get(this.dnnContext.$2sxc.http.apiUrl(g.c),{params:{appId:this.context.appId.toString(),id:t.toString()}}).pipe(Object(h.a)((function(t){return t.DataSources.length||e.buildDefaultModel(t),e.fixPipelineDataSources(t.DataSources),t})))},t.prototype.buildDefaultModel=function(t){var e,n,i=v.a.pipelineDesigner.defaultPipeline.dataSources;try{for(var o=Object(b.h)(i),r=o.next();!r.done;r=o.next()){var a=r.value;null==a.visualDesignerData&&(a.visualDesignerData={Top:100,Left:100});var c={Description:"",EntityGuid:a.entityGuid||"unsaved"+(t.DataSources.length+1),EntityId:void 0,Name:this.typeNameFilter(a.partAssemblyAndType,"className"),PartAssemblyAndType:a.partAssemblyAndType,VisualDesignerData:a.visualDesignerData};t.DataSources.push(c)}}catch(s){e={error:s}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}t.Pipeline.StreamWiring=v.a.pipelineDesigner.defaultPipeline.streamWiring},t.prototype.fixPipelineDataSources=function(t){var e,n;if(!t.some((function(t){return"Out"===t.EntityGuid}))){var i=v.a.pipelineDesigner.outDataSource;t.push({Description:i.description,EntityGuid:"Out",EntityId:void 0,Name:i.name,PartAssemblyAndType:i.className,VisualDesignerData:i.visualDesignerData})}try{for(var o=Object(b.h)(t),r=o.next();!r.done;r=o.next()){var a=r.value;a.VisualDesignerData=a.VisualDesignerData||{Top:50,Left:50}}}catch(c){e={error:c}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(e)throw e.error}}},t.prototype.fetchDataSources=function(){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(g.b)).pipe(Object(h.a)((function(t){var e=v.a.pipelineDesigner.outDataSource;return t.push({ContentType:void 0,Difficulty:100,DynamicOut:!1,EnableConfig:void 0,HelpLink:void 0,Icon:void 0,In:e.in,Name:e.name||e.className,Out:void 0,PartAssemblyAndType:e.className,PrimaryType:"Target",UiHint:void 0,allowNew:!1}),t})))},t.prototype.typeNameFilter=function(t,e){var n=t.split(", ");switch(e){case"classFullName":return n[0];case"className":var i=n[0].split(".");return i[i.length-1]}return t},t.prototype.savePipeline=function(t){var e=this,n=t.Pipeline,i=t.DataSources;return this.http.post(this.dnnContext.$2sxc.http.apiUrl(g.e),{pipeline:n,dataSources:i},{params:{appId:this.context.appId.toString(),Id:n.EntityId.toString()}}).pipe(Object(h.a)((function(t){return e.fixPipelineDataSources(t.DataSources),t})))},t.prototype.runPipeline=function(t){return this.http.get(this.dnnContext.$2sxc.http.apiUrl(g.d),{params:{appId:this.context.appId.toString(),id:t.toString()}})},t.\u0275fac=function(e){return new(e||t)(y.Wb(m.b),y.Wb(d.a),y.Wb(S.a))},t.\u0275prov=y.Ib({token:t,factory:t.\u0275fac}),t}(),P=n("sEIs"),C=n("it7M"),D=n("C05f"),k=n("bwdy"),R=n("HM3f"),M=n("1/u/"),x={Cache:{name:"Cache",icon:"history",notes:"Caching of data"},Filter:{name:"Filter",icon:"filter_list",notes:"Filter data - usually returning less items than came in"},Logic:{name:"Logic",icon:"share",notes:"Logic operations - usually choosing between different streams"},Lookup:{name:"Lookup",icon:"search",notes:"Lookup operation - usually looking for other data based on a criteria"},Modify:{name:"Modify",icon:"star_half",notes:"Modify data - usually changing, adding or removing values"},Security:{name:"Security",icon:"account_circle",notes:"Security - usually limit what the user sees based on his identity"},Sort:{name:"Sort",icon:"sort",notes:"Sort the items"},Source:{name:"Source",icon:"cloud_upload",notes:"Source of new data - usually SQL, CSV or similar"},Target:{name:"Target",icon:"adjust",notes:"Target - usually just a destination of data"},Unknown:{name:"Unknown",icon:"fiber_manual_record",notes:"Unknown type"}};function w(t,e){var n,i,o={},r=function(t){var n=void 0,i=e.find((function(e){return e.PartAssemblyAndType===t.PartAssemblyAndType}));i&&(n=Object(b.a)({},i.PrimaryType?x[i.PrimaryType]:x.Unknown),i.Icon&&(n.icon=i.Icon),i.DynamicOut&&(n.dynamicOut=!0),i.HelpLink&&(n.helpLink=i.HelpLink),i.EnableConfig&&(n.config=i.EnableConfig)),n||(n=x.Unknown),o[t.EntityGuid]=n};try{for(var a=Object(b.h)(t),c=a.next();!c.done;c=a.next())r(c.value)}catch(s){n={error:s}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return o}var I="dataSource_",A=function(){function t(t,e,n,i,o,r){var a=this;this.jsPlumbRoot=t,this.pipelineModel=e,this.dataSources=n,this.onConnectionsChanged=i,this.onDragend=o,this.plumbInits=r,this.lineCount=0,this.linePaintDefault={stroke:"#61B7CF",strokeWidth:4,outlineStroke:"white",outlineWidth:2},this.lineColors=["#009688","#00bcd4","#3f51b5","#9c27b0","#e91e63","#db4437","#ff9800","#60a917","#60a917","#008a00","#00aba9","#1ba1e2","#0050ef","#6a00ff","#aa00ff","#f472d0","#d80073","#a20025","#e51400","#fa6800","#f0a30a","#e3c800","#825a2c","#6d8764","#647687","#76608a","#a0522d"],this.maxCols=this.lineColors.length-1,this.uuidColorMap={},this.bulkDelete=!1,this.instance=jsPlumb.getInstance(this.getInstanceDefaults(this.jsPlumbRoot)),this.instance.batch((function(){a.initDomDataSources(),a.initWirings(),a.bindEvents()})),this.instance.repaintEverything()}return t.prototype.destroy=function(){this.instance.reset()},t.prototype.removeEndpointsOnDataSource=function(t){var e=this,n=I+t;this.bulkDelete=!0,this.instance.batch((function(){e.instance.selectEndpoints({element:n}).delete()})),this.bulkDelete=!1},t.prototype.getAllConnections=function(){return this.instance.getAllConnections().map((function(t){return{From:t.sourceId.replace(I,""),Out:t.endpoints[0].getOverlay("endpointLabel").label,To:t.targetId.replace(I,""),In:t.endpoints[1].getOverlay("endpointLabel").label}}))},t.prototype.getStreamsOut=function(){var t=[];return this.instance.selectEndpoints({target:"dataSource_Out"}).each((function(e){t.push(e.getOverlay("endpointLabel").label)})),t.join(",")},t.prototype.putEntityCountOnConnections=function(t){var e,n=this;null===(e=t.Streams)||void 0===e||e.forEach((function(t){var e,i=I+t.Source,o=(["00000000-0000-0000-0000-000000000000",n.pipelineModel.Pipeline.EntityGuid].includes(t.Target)?"dataSource_Out":I+t.Target)+"_in_"+t.TargetIn,r=n.instance.getEndpoint(i+"_out_"+t.SourceOut);null===(e=null==r?void 0:r.connections)||void 0===e||e.forEach((function(e){e.endpoints[1].getUuid()===o&&e.setLabel({label:t.Count.toString(),cssClass:"streamEntitiesCount"})}))}))},t.prototype.nextLinePaintStyle=function(t){return this.uuidColorMap[t]||(this.uuidColorMap[t]=Object.assign({},this.linePaintDefault,{stroke:this.lineColors[this.lineCount++%this.maxCols]}))},t.prototype.getInstanceDefaults=function(t){return{Container:t,Connector:["Bezier",{curviness:70}],PaintStyle:this.nextLinePaintStyle("dummy"),HoverPaintStyle:{stroke:"#216477",strokeWidth:4,outlineStroke:"white",outlineWidth:2}}},t.prototype.initDomDataSources=function(){var t,e,n,i,o=this,r=function(t){var e=a.jsPlumbRoot.querySelector("#dataSource_"+t.EntityGuid);if(!e)return"continue";var r=a.dataSources.find((function(e){return e.PartAssemblyAndType===t.PartAssemblyAndType}));if(!r)return"continue";if(a.pipelineModel.Pipeline.AllowEdit&&a.instance.draggable(e,{grid:[20,20],stop:function(t){var e=t.el.id.replace(I,""),n={Top:t.finalPos[1],Left:t.finalPos[0]};setTimeout((function(){o.onDragend(e,n)}))}}),null===(n=r.Out)||void 0===n||n.forEach((function(n){o.addEndpoint(e,n,!1,t)})),null===(i=r.In)||void 0===i||i.forEach((function(n){o.addEndpoint(e,n,!0,t)})),r.In){var c=a.buildTargetEndpoint();c.maxConnections=-1,a.instance.makeTarget(e,c)}r.DynamicOut&&a.instance.makeSource(e,a.buildSourceEndpoint(),{filter:".add-endpoint .new-connection"})},a=this;try{for(var c=Object(b.h)(this.pipelineModel.DataSources),s=c.next();!s.done;s=c.next())r(s.value)}catch(l){t={error:l}}finally{try{s&&!s.done&&(e=c.return)&&e.call(c)}finally{if(t)throw t.error}}},t.prototype.initWirings=function(){var t,e=this;null===(t=this.pipelineModel.Pipeline.StreamWiring)||void 0===t||t.forEach((function(t){var n=I+t.From,i=n+"_out_"+t.Out,o=I+t.To,r=o+"_in_"+t.In;if(!e.instance.getEndpoint(i)){var a=(s=e.jsPlumbRoot.querySelector("#"+n)).id.replace(I,""),c=e.pipelineModel.DataSources.find((function(t){return t.EntityGuid===a}));e.addEndpoint(s,t.Out,!1,c)}if(!e.instance.getEndpoint(r)){var s,l=(s=e.jsPlumbRoot.querySelector("#"+o)).id.replace(I,"");c=e.pipelineModel.DataSources.find((function(t){return t.EntityGuid===l})),e.addEndpoint(s,t.In,!0,c)}try{e.instance.connect({uuids:[i,r],paintStyle:e.nextLinePaintStyle(i)})}catch(u){console.error({message:"Connection failed",from:i,to:r})}}))},t.prototype.addEndpoint=function(t,e,n,i){var o=t.id+(n?"_in_":"_out_")+e,r=n?this.buildTargetEndpoint():this.buildSourceEndpoint();this.instance.addEndpoint(t,r,{uuid:o,enabled:this.pipelineModel.Pipeline.AllowEdit||"Out"===i.EntityGuid}).getOverlay("endpointLabel").setLabel(e)},t.prototype.buildSourceEndpoint=function(){return{paintStyle:{fill:"transparent",radius:10},cssClass:"sourceEndpoint",maxConnections:-1,isSource:!0,anchor:["Continuous",{faces:["top"]}],overlays:this.getEndpointOverlays(!0)}},t.prototype.buildTargetEndpoint=function(){return{paintStyle:{fill:"transparent",radius:10},cssClass:"targetEndpoint",maxConnections:1,isTarget:!0,anchor:["Continuous",{faces:["bottom"]}],overlays:this.getEndpointOverlays(!1),dropOptions:{hoverClass:"hover",activeClass:"active"}}},t.prototype.getEndpointOverlays=function(t){var e=this;return[["Label",{id:"endpointLabel",location:[.5,t?0:1],label:"Default",cssClass:"noselect "+(t?"endpointSourceLabel":"endpointTargetLabel"),events:{dblclick:function(t){if(e.pipelineModel.Pipeline.AllowEdit&&(null==t.dblClickCounter||t.dblClickCounter>=e.plumbInits?t.dblClickCounter=1:t.dblClickCounter++,!(t.dblClickCounter>1))){var n=prompt("Rename stream",t.label);n&&(t.setLabel(n),setTimeout((function(){e.onConnectionsChanged()})))}}}}]]},t.prototype.bindEvents=function(){var t=this;this.instance.bind("connectionDetached",(function(e){if(!t.bulkDelete){var n=e.target,i=t.pipelineModel.DataSources.find((function(t){return t.EntityGuid===n.id.replace(I,"")})),o=t.dataSources.find((function(t){return t.PartAssemblyAndType===i.PartAssemblyAndType})).In,r=e.targetEndpoint.getOverlay("endpointLabel").label;o.includes(r)||t.instance.deleteEndpoint(e.targetEndpoint),setTimeout((function(){t.onConnectionsChanged()}))}})),this.instance.bind("connection",(function(e){if(e.sourceId!==e.targetId){var n=e.targetEndpoint.getOverlay("endpointLabel"),i=n.getLabel();t.instance.getEndpoints(e.target.id).some((function(t){return t.getOverlay("endpointLabel").getLabel()===i&&e.targetEndpoint.id!==t.id&&t.canvas.classList.contains("targetEndpoint")}))&&n.setLabel("PleaseRename"+Math.floor(99999*Math.random())),setTimeout((function(){t.onConnectionsChanged()}))}else setTimeout((function(){t.instance.deleteConnection(e.connection,{fireEvent:!1}),setTimeout((function(){t.onConnectionsChanged()}))}))}))},t}(),E=n("9RHM"),T=n("ZTXN"),_=n("KTx3"),$=n("xVbo"),j=n("jIqt"),Q=n("0Woy"),N=n("uuTa");function L(t,e){if(1&t&&(y.Sb(0,"li"),y.Oc(1),y.Rb()),2&t){var n=e.$implicit;y.Ab(1),y.Pc(n)}}function F(t,e){if(1&t&&(y.Sb(0,"li"),y.Sb(1,"b"),y.Oc(2),y.Rb(),y.Oc(3,"="),y.Sb(4,"em"),y.Oc(5),y.Rb(),y.Rb()),2&t){var n=e.$implicit;y.Ab(2),y.Pc(n.key),y.Ab(3),y.Pc(n.value)}}function G(t,e){if(1&t&&(y.Sb(0,"tr"),y.Sb(1,"td"),y.Sb(2,"pre"),y.Oc(3),y.Rb(),y.Rb(),y.Sb(4,"td"),y.Oc(5),y.Rb(),y.Sb(6,"td"),y.Sb(7,"ol"),y.Mc(8,F,6,2,"li",5),y.fc(9,"keyvalue"),y.Rb(),y.Rb(),y.Sb(10,"td"),y.Oc(11),y.Rb(),y.Rb()),2&t){var n=e.$implicit;y.Ab(3),y.Pc(n.value.Guid),y.Ab(2),y.Pc(n.value.Type),y.Ab(3),y.kc("ngForOf",y.gc(9,4,n.value.Configuration)),y.Ab(3),y.Pc(n.value.Error)}}function W(t,e){if(1&t&&(y.Sb(0,"tr"),y.Sb(1,"td"),y.Sb(2,"pre"),y.Oc(3),y.Rb(),y.Rb(),y.Sb(4,"td"),y.Sb(5,"pre"),y.Oc(6),y.Rb(),y.Rb(),y.Sb(7,"td"),y.Oc(8),y.Rb(),y.Sb(9,"td"),y.Oc(10),y.Rb(),y.Rb()),2&t){var n=e.$implicit;y.Ab(3),y.Pc(n.Source+":"+n.SourceOut),y.Ab(3),y.Pc(n.Target+":"+n.TargetIn),y.Ab(2),y.Pc(n.Count),y.Ab(2),y.Pc(n.Error)}}var U=function(){function t(t,e){this.dialogData=t,this.dialogRef=e}return t.prototype.ngOnInit=function(){this.testParameters=this.dialogData.testParameters,this.timeUsed=this.dialogData.result.QueryTimer.Milliseconds,this.ticksUsed=this.dialogData.result.QueryTimer.Ticks,this.result=this.dialogData.result.Query,this.sources=this.dialogData.result.Sources,this.streams=this.dialogData.result.Streams},t.prototype.closeDialog=function(){this.dialogRef.close()},t.\u0275fac=function(e){return new(e||t)(y.Mb(r.a),y.Mb(r.g))},t.\u0275cmp=y.Gb({type:t,selectors:[["app-query-result"]],decls:55,vars:10,consts:[["mat-dialog-title",""],[1,"dialog-title-box"],["mat-icon-button","","matTooltip","Close dialog",3,"click"],[1,"dialog-description"],[1,"description"],[4,"ngFor","ngForOf"]],template:function(t,e){1&t&&(y.Sb(0,"div",0),y.Sb(1,"div",1),y.Sb(2,"div"),y.Oc(3,"Query Results"),y.Rb(),y.Sb(4,"button",2),y.ac("click",(function(){return e.closeDialog()})),y.Sb(5,"mat-icon"),y.Oc(6,"close"),y.Rb(),y.Rb(),y.Rb(),y.Rb(),y.Sb(7,"p",3),y.Oc(8," The Full result was logged to the Browser Console. Further down you'll find more debug-infos.\n"),y.Rb(),y.Nb(9,"br"),y.Sb(10,"div",0),y.Sb(11,"div",1),y.Oc(12,"Parameters & Statistics"),y.Rb(),y.Rb(),y.Sb(13,"p",4),y.Oc(14),y.Rb(),y.Sb(15,"ul",4),y.Mc(16,L,2,1,"li",5),y.Rb(),y.Nb(17,"br"),y.Sb(18,"div",0),y.Sb(19,"div",1),y.Oc(20,"Query Results"),y.Rb(),y.Rb(),y.Sb(21,"pre"),y.Oc(22),y.fc(23,"json"),y.Rb(),y.Nb(24,"br"),y.Sb(25,"div",0),y.Sb(26,"div",1),y.Oc(27,"Sources"),y.Rb(),y.Rb(),y.Sb(28,"table",4),y.Sb(29,"tr"),y.Sb(30,"th"),y.Oc(31,"Guid"),y.Rb(),y.Sb(32,"th"),y.Oc(33,"Type"),y.Rb(),y.Sb(34,"th"),y.Oc(35,"Configuration"),y.Rb(),y.Sb(36,"th"),y.Oc(37,"Error"),y.Rb(),y.Rb(),y.Mc(38,G,12,6,"tr",5),y.fc(39,"keyvalue"),y.Rb(),y.Nb(40,"br"),y.Sb(41,"div",0),y.Sb(42,"div",1),y.Oc(43,"Streams"),y.Rb(),y.Rb(),y.Sb(44,"table",4),y.Sb(45,"tr"),y.Sb(46,"th"),y.Oc(47,"Source"),y.Rb(),y.Sb(48,"th"),y.Oc(49,"Target"),y.Rb(),y.Sb(50,"th"),y.Oc(51,"Items"),y.Rb(),y.Sb(52,"th"),y.Oc(53,"Error"),y.Rb(),y.Rb(),y.Mc(54,W,11,4,"tr",5),y.Rb()),2&t&&(y.Ab(14),y.Rc(" Executed in ",e.timeUsed,"ms (",e.ticksUsed," ticks)\n"),y.Ab(2),y.kc("ngForOf",null==e.testParameters?null:e.testParameters.split("\n")),y.Ab(6),y.Qc("  ",y.gc(23,6,e.result),"\n"),y.Ab(16),y.kc("ngForOf",y.gc(39,8,e.sources)),y.Ab(16),y.kc("ngForOf",e.streams))},directives:[r.h,o.b,l.a,a.a,i.s],pipes:[i.k,i.l],styles:[".description[_ngcontent-%COMP%]{font-size:14px}pre[_ngcontent-%COMP%]{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px;overflow-x:auto}th[_ngcontent-%COMP%]{text-align:left}"],changeDetection:0}),t}(),q=n("e4iD"),V=function(){function t(t,e,n,i,o,r,a,c,s,l,u){this.router=t,this.route=e,this.queryDefinitionService=n,this.titleService=i,this.snackBar=o,this.dialog=r,this.viewContainerRef=a,this.zone=c,this.metadataService=s,this.contentTypesService=l,this.changeDetectorRef=u,this.pipelineModel$=new D.a(null),this.dataSources$=new D.a(null),this.putEntityCountOnConnections$=new T.a,this.pipelineId=parseInt(this.route.snapshot.paramMap.get("pipelineId"),10),this.doRefresh=!1,this.subscription=new k.a}return t.prototype.ngOnDestroy=function(){this.pipelineModel$.complete(),this.dataSources$.complete(),this.putEntityCountOnConnections$.complete(),this.subscription.unsubscribe()},t.prototype.init=function(){this.fetchPipeline(),this.fetchDataSources(),this.attachKeyboardSave(),this.refreshOnChildClosed()},t.prototype.editPipelineEntity=function(){var t=this;this.savePipeline((function(){var e={items:[{EntityId:t.pipelineModel$.value.Pipeline.EntityId}]},n=Object(N.a)(e);t.doRefresh=!0,t.router.navigate(["edit/"+n],{relativeTo:t.route})}))},t.prototype.saveAndRun=function(t,e){var n=this;t&&e?this.savePipeline((function(){n.runPipeline()})):t?this.savePipeline():e&&this.runPipeline()},t.prototype.addDataSource=function(t){var e=Object(E.a)(this.pipelineModel$.value),n={Description:"",EntityGuid:"unsaved"+(e.DataSources.length+1),EntityId:void 0,Name:this.queryDefinitionService.typeNameFilter(t.PartAssemblyAndType,"className"),PartAssemblyAndType:t.PartAssemblyAndType,VisualDesignerData:{Top:100,Left:100}};e.DataSources.push(n),this.pipelineModel$.next(e),this.savePipeline()},t.prototype.removeDataSource=function(t,e,n){var i=Object(E.a)(this.pipelineModel$.value);i.DataSources=i.DataSources.filter((function(e){return e.EntityGuid!==t})),i.Pipeline.StreamWiring=e,i.Pipeline.StreamsOut=n,this.pipelineModel$.next(i)},t.prototype.renameDataSource=function(t,e){var n=Object(E.a)(this.pipelineModel$.value);n.DataSources.find((function(e){return e.EntityGuid===t})).Name=e,this.pipelineModel$.next(n)},t.prototype.changeDataSourceDescription=function(t,e){var n=Object(E.a)(this.pipelineModel$.value);n.DataSources.find((function(e){return e.EntityGuid===t})).Description=e,this.pipelineModel$.next(n)},t.prototype.changeConnections=function(t,e){var n=Object(E.a)(this.pipelineModel$.value);n.Pipeline.StreamWiring=t,n.Pipeline.StreamsOut=e,this.pipelineModel$.next(n)},t.prototype.changeDataSourcePosition=function(t,e){var n=Object(E.a)(this.pipelineModel$.value),i=n.DataSources.find((function(e){return e.EntityGuid===t}));i&&(i.VisualDesignerData=Object(b.a)(Object(b.a)({},i.VisualDesignerData),e),this.pipelineModel$.next(n))},t.prototype.editDataSource=function(t){var e=this,n=this.dataSources$.value.find((function(e){return e.PartAssemblyAndType===t.PartAssemblyAndType})),i=(null==n?void 0:n.ContentType)?n.ContentType:"|Config "+this.queryDefinitionService.typeNameFilter(t.PartAssemblyAndType,"classFullName"),o=t.EntityGuid;this.metadataService.getMetadata(v.a.metadata.entity.type,v.a.keyTypes.guid,o,i).subscribe((function(t){if(t.length){var n={items:[{EntityId:t[0].Id}]},r=Object(N.a)(n);e.router.navigate(["edit/"+r],{relativeTo:e.route})}else e.contentTypesService.retrieveContentType(i).subscribe({next:function(t){var n={items:[{ContentTypeName:i,For:{Target:v.a.metadata.entity.target,Guid:o}}]},r=Object(N.a)(n);e.router.navigate(["edit/"+r],{relativeTo:e.route})},error:function(t){alert("Server reports error - this usually means that this data-source doesn't have any configuration")}})}))},t.prototype.savePipeline=function(t){var e=this;this.snackBar.open("Saving..."),this.queryDefinitionService.savePipeline(this.pipelineModel$.value).subscribe({next:function(n){e.snackBar.open("Saved",null,{duration:2e3}),e.pipelineModel$.next(n),null!=t&&t()},error:function(t){e.snackBar.open("Save Pipeline failed",null,{duration:2e3})}})},t.prototype.runPipeline=function(){var t=this;this.snackBar.open("Running query..."),this.queryDefinitionService.runPipeline(this.pipelineModel$.value.Pipeline.EntityId).subscribe({next:function(e){t.snackBar.open("Query worked",null,{duration:2e3}),t.dialog.open(U,{data:{testParameters:t.pipelineModel$.value.Pipeline.TestParameters,result:e},backdropClass:"dialog-backdrop",panelClass:["dialog-panel","dialog-panel-medium","no-scrollbar"],viewContainerRef:t.viewContainerRef,autoFocus:!1,closeOnNavigation:!1,position:{top:"0"}}),t.changeDetectorRef.markForCheck(),console.warn(e),setTimeout((function(){t.putEntityCountOnConnections$.next(e)}))},error:function(e){t.snackBar.open("Query failed",null,{duration:2e3})}})},t.prototype.fetchPipeline=function(t){var e=this;void 0===t&&(t=!1),t&&this.snackBar.open("Reloading query, please wait..."),this.queryDefinitionService.fetchPipeline(this.pipelineId).subscribe((function(n){t&&e.snackBar.open("Query reloaded",null,{duration:2e3}),e.pipelineModel$.next(n),e.titleService.setTitle(n.Pipeline.Name+" - Visual Query")}))},t.prototype.fetchDataSources=function(){var t=this;this.queryDefinitionService.fetchDataSources().subscribe((function(e){t.dataSources$.next(e)}))},t.prototype.attachKeyboardSave=function(){var t=this;this.zone.runOutsideAngular((function(){t.subscription.add(Object(_.a)(window,"keydown").pipe(Object($.a)((function(){return!t.route.snapshot.firstChild})),Object($.a)((function(t){return(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)&&83===t.keyCode}))).subscribe((function(e){e.preventDefault(),t.zone.run((function(){t.savePipeline()}))})))}))},t.prototype.refreshOnChildClosed=function(){var t=this;this.subscription.add(this.router.events.pipe(Object($.a)((function(t){return t instanceof P.b})),Object(j.a)(!!this.route.snapshot.firstChild),Object(h.a)((function(){return!!t.route.snapshot.firstChild})),Object(Q.a)(),Object($.a)((function(t){var e=Object(b.f)(t,2);return e[0]&&!e[1]})),Object($.a)((function(){var e=t.doRefresh;return t.doRefresh=!1,e}))).subscribe((function(){t.fetchPipeline(!0)})))},t.\u0275fac=function(e){return new(e||t)(y.Wb(P.c),y.Wb(P.a),y.Wb(O),y.Wb(q.c),y.Wb(s.b),y.Wb(r.b),y.Wb(y.Q),y.Wb(y.A),y.Wb(p.a),y.Wb(u.a),y.Wb(y.h))},t.\u0275prov=y.Ib({token:t,factory:t.\u0275fac}),t}(),B=n("kVtj"),H=["domRoot"],z=["domDataSource"];function K(t,e){if(1&t){var n=y.Tb();y.Sb(0,"div",16),y.ac("click",(function(){y.Ac(n);var t=y.ec().$implicit;return y.ec(3).configureDataSource(t)})),y.Sb(1,"mat-icon",17),y.Oc(2,"settings"),y.Rb(),y.Rb()}}function Y(t,e){1&t&&(y.Sb(0,"div",18),y.Sb(1,"mat-icon",19),y.Oc(2,"arrow_drop_up"),y.Rb(),y.Rb())}function J(t,e){if(1&t){var n=y.Tb();y.Sb(0,"mat-icon",20),y.ac("click",(function(){y.Ac(n);var t=y.ec().$implicit;return y.ec(3).remove(t)})),y.Oc(1," delete "),y.Rb()}}function X(t,e){if(1&t&&(y.Sb(0,"a",21),y.Sb(1,"mat-icon"),y.Oc(2,"help_outline"),y.Rb(),y.Rb()),2&t){var n=y.ec().$implicit,i=y.ec(2).ngIf;y.kc("href",i.typeInfos[n.EntityGuid].helpLink,y.Dc)}}var Z=function(t,e,n){return{top:t,left:e,"min-width":n}};function tt(t,e){if(1&t){var n=y.Tb();y.Sb(0,"div",5,6),y.Mc(2,K,3,0,"div",7),y.Sb(3,"mat-icon",8),y.Oc(4),y.Rb(),y.Sb(5,"div",9),y.ac("click",(function(){y.Ac(n);var t=e.$implicit,i=y.ec(2).ngIf,o=y.ec();return i.allowEdit&&o.editName(t)})),y.Sb(6,"span"),y.Oc(7),y.Rb(),y.Sb(8,"mat-icon",10),y.Oc(9,"edit"),y.Rb(),y.Rb(),y.Nb(10,"br"),y.Sb(11,"div",11),y.ac("click",(function(){y.Ac(n);var t=e.$implicit,i=y.ec(2).ngIf,o=y.ec();return i.allowEdit&&o.editDescription(t)})),y.Sb(12,"span"),y.Oc(13),y.Rb(),y.Sb(14,"mat-icon",10),y.Oc(15,"edit"),y.Rb(),y.Rb(),y.Nb(16,"br"),y.Sb(17,"div",12),y.Oc(18),y.Rb(),y.Mc(19,Y,3,0,"div",13),y.Mc(20,J,2,0,"mat-icon",14),y.Mc(21,X,3,1,"a",15),y.Rb()}if(2&t){var i=e.$implicit,o=y.ec(2).ngIf,r=y.ec();y.kc("id",r.dataSrcIdPrefix+i.EntityGuid)("ngStyle",y.qc(12,Z,i.VisualDesignerData.Top+"px",i.VisualDesignerData.Left+"px",i.VisualDesignerData.Width?i.VisualDesignerData.Width+"px":null)),y.Ab(2),y.kc("ngIf",o.allowEdit&&o.typeInfos[i.EntityGuid].config),y.Ab(1),y.kc("title",o.typeInfos[i.EntityGuid].notes),y.Ab(1),y.Qc(" ",o.typeInfos[i.EntityGuid].icon," "),y.Ab(3),y.Pc(i.Name||"(no name)"),y.Ab(6),y.Pc(i.Description),y.Ab(4),y.kc("title",i.PartAssemblyAndType),y.Ab(1),y.Qc(" Type: ",r.typeNameFilter(i.PartAssemblyAndType,"className")," "),y.Ab(1),y.kc("ngIf",o.allowEdit&&o.typeInfos[i.EntityGuid].dynamicOut),y.Ab(1),y.kc("ngIf",o.allowEdit),y.Ab(1),y.kc("ngIf",o.typeInfos[i.EntityGuid].helpLink)}}function et(t,e){if(1&t&&(y.Qb(0),y.Mc(1,tt,22,16,"div",4),y.Pb()),2&t){var n=y.ec().ngIf;y.Ab(1),y.kc("ngForOf",n.pipelineDataSources)}}function nt(t,e){if(1&t&&(y.Sb(0,"div",1,2),y.Mc(2,et,2,1,"ng-container",3),y.Rb()),2&t){var n=y.ec();y.Ab(2),y.kc("ngIf",!n.hardReset)}}var it=function(){function t(t,e,n){this.visualQueryService=t,this.queryDefinitionService=e,this.changeDetectorRef=n,this.dataSrcIdPrefix=I,this.hardReset=!1,this.scriptLoaded$=new D.a(!1),this.subscription=new k.a,this.plumbInits=0}return t.prototype.ngOnInit=function(){var t=this;Object(M.a)([{test:"jsPlumb",src:"https://cdnjs.cloudflare.com/ajax/libs/jsPlumb/2.14.5/js/jsplumb.min.js"}],(function(){t.scriptLoaded$.next(!0)})),this.subscription.add(this.visualQueryService.putEntityCountOnConnections$.subscribe((function(e){t.plumber.putEntityCountOnConnections(e)}))),this.templateModel$=Object(R.a)([this.visualQueryService.pipelineModel$,this.visualQueryService.dataSources$]).pipe(Object(h.a)((function(e){var n=Object(b.f)(e,2),i=n[0],o=n[1];if(null!=i&&null!=o)return t.hardReset=!0,t.changeDetectorRef.detectChanges(),t.hardReset=!1,{pipelineDataSources:i.DataSources,typeInfos:w(i.DataSources,o),allowEdit:i.Pipeline.AllowEdit}})))},t.prototype.ngAfterViewInit=function(){var t=this,e=this.domDataSourcesRef.changes.pipe(Object(h.a)((function(){return!0})));this.subscription.add(Object(R.a)([this.scriptLoaded$,e]).subscribe((function(e){var n,i=Object(b.f)(e,2);i[0]&&i[1]&&(null===(n=t.plumber)||void 0===n||n.destroy(),t.plumber=new A(t.domRootRef.nativeElement,t.visualQueryService.pipelineModel$.value,t.visualQueryService.dataSources$.value,t.onConnectionsChanged.bind(t),t.onDragend.bind(t),++t.plumbInits))})))},t.prototype.ngOnDestroy=function(){var t;null===(t=this.plumber)||void 0===t||t.destroy(),this.scriptLoaded$.complete(),this.subscription.unsubscribe()},t.prototype.onConnectionsChanged=function(){var t=this.plumber.getAllConnections(),e=this.plumber.getStreamsOut();this.visualQueryService.changeConnections(t,e)},t.prototype.onDragend=function(t,e){this.visualQueryService.changeDataSourcePosition(t,e)},t.prototype.configureDataSource=function(t){t.EntityGuid.includes("unsaved")?this.visualQueryService.saveAndRun(!0,!1):this.visualQueryService.editDataSource(t)},t.prototype.typeNameFilter=function(t,e){return this.queryDefinitionService.typeNameFilter(t,e)},t.prototype.remove=function(t){if(confirm("Delete "+t.Name+" data source?")){this.plumber.removeEndpointsOnDataSource(t.EntityGuid);var e=this.plumber.getAllConnections(),n=this.plumber.getStreamsOut();this.visualQueryService.removeDataSource(t.EntityGuid,e,n)}},t.prototype.editName=function(t){var e,n=null===(e=prompt("Rename data source",t.Name))||void 0===e?void 0:e.trim();null!=n&&""!==n&&this.visualQueryService.renameDataSource(t.EntityGuid,n)},t.prototype.editDescription=function(t){var e,n=null===(e=prompt("Edit description",t.Description))||void 0===e?void 0:e.trim();null!=n&&this.visualQueryService.changeDataSourceDescription(t.EntityGuid,n)},t.\u0275fac=function(e){return new(e||t)(y.Mb(V),y.Mb(O),y.Mb(y.h))},t.\u0275cmp=y.Gb({type:t,selectors:[["app-plumb-editor"]],viewQuery:function(t,e){var n;1&t&&(y.Tc(H,!0),y.Tc(z,!0)),2&t&&(y.xc(n=y.bc())&&(e.domRootRef=n.first),y.xc(n=y.bc())&&(e.domDataSourcesRef=n))},decls:2,vars:3,consts:[["id","pipeline-root",4,"ngIf"],["id","pipeline-root"],["domRoot",""],[4,"ngIf"],["class","dataSource",3,"id","ngStyle",4,"ngFor","ngForOf"],[1,"dataSource",3,"id","ngStyle"],["domDataSource",""],["class","configure","title","Configure data source","appMousedownStopPropagation","",3,"click",4,"ngIf"],[1,"type-info",3,"title"],["title","Click to edit name","appMousedownStopPropagation","",1,"name","noselect",3,"click"],[1,"show-hover-inline","eav-icon-pencil"],["title","Click to edit description","appMousedownStopPropagation","",1,"description","noselect",3,"click"],[1,"typename",3,"title"],["class","add-endpoint","title","Drag a new Out-Connection",4,"ngIf"],["class","delete eav-icon-cancel","title","Delete","appMousedownStopPropagation","",3,"click",4,"ngIf"],["class","help eav-icon-help-circled","title","Help for this data source","target","_blank","appMousedownStopPropagation","",3,"href",4,"ngIf"],["title","Configure data source","appMousedownStopPropagation","",1,"configure",3,"click"],[1,"eav-icon-settings"],["title","Drag a new Out-Connection",1,"add-endpoint"],[1,"new-connection","eav-icon-up-dir"],["title","Delete","appMousedownStopPropagation","",1,"delete","eav-icon-cancel",3,"click"],["title","Help for this data source","target","_blank","appMousedownStopPropagation","",1,"help","eav-icon-help-circled",3,"href"]],template:function(t,e){1&t&&(y.Mc(0,nt,3,1,"div",0),y.fc(1,"async")),2&t&&y.kc("ngIf",y.gc(1,1,e.templateModel$))},directives:[i.t,i.s,i.w,a.a,B.a],pipes:[i.b],styles:["","[_nghost-%COMP%] { display: block; width: 100%; height: 100%; }"],changeDetection:0}),t}();function ot(t,e){if(1&t&&(y.Sb(0,"li"),y.Oc(1),y.Rb()),2&t){var n=e.$implicit;y.Ab(1),y.Qc(" ",n," ")}}function rt(t,e){if(1&t&&(y.Sb(0,"ul",13),y.Mc(1,ot,2,1,"li",14),y.Rb()),2&t){var n=y.ec().ngIf;y.Ab(1),y.kc("ngForOf",null==n.Pipeline.Params?null:n.Pipeline.Params.split("\n"))}}function at(t,e){if(1&t&&(y.Sb(0,"li"),y.Oc(1),y.Rb()),2&t){var n=e.$implicit;y.Ab(1),y.Qc(" ",n," ")}}function ct(t,e){if(1&t&&(y.Sb(0,"ul",13),y.Mc(1,at,2,1,"li",14),y.Rb()),2&t){var n=y.ec().ngIf;y.Ab(1),y.kc("ngForOf",null==n.Pipeline.TestParameters?null:n.Pipeline.TestParameters.split("\n"))}}function st(t,e){if(1&t&&(y.Sb(0,"li"),y.Oc(1),y.Rb()),2&t){var n=e.$implicit;y.Ab(1),y.Qc(" ",n," ")}}function lt(t,e){if(1&t&&(y.Sb(0,"div",16),y.Sb(1,"div",7),y.Sb(2,"span"),y.Oc(3,"Warnings"),y.Rb(),y.Sb(4,"mat-icon",17),y.Oc(5,"warning"),y.Rb(),y.Rb(),y.Sb(6,"ol",13),y.Mc(7,st,2,1,"li",14),y.Rb(),y.Rb()),2&t){var n=y.ec().ngIf;y.Ab(7),y.kc("ngForOf",n)}}function ut(t,e){if(1&t&&(y.Qb(0),y.Mc(1,lt,8,1,"div",15),y.Pb()),2&t){var n=e.ngIf;y.Ab(1),y.kc("ngIf",n.length)}}function pt(t,e){if(1&t&&(y.Sb(0,"div",18),y.Sb(1,"div",7),y.Oc(2,"Query Description"),y.Rb(),y.Sb(3,"div"),y.Oc(4),y.Rb(),y.Rb()),2&t){var n=y.ec().ngIf;y.Ab(4),y.Pc(n.Pipeline.Description)}}function dt(t,e){if(1&t){var n=y.Tb();y.Sb(0,"div",1),y.Sb(1,"div",2),y.Sb(2,"div",3),y.Sb(3,"button",4),y.ac("click",(function(){return y.Ac(n),y.ec().saveAndRunQuery(!0,!0)})),y.Oc(4," Save and run "),y.Rb(),y.Sb(5,"button",5),y.ac("click",(function(){return y.Ac(n),y.ec().saveAndRunQuery(!1,!0)})),y.Oc(6," Run "),y.Rb(),y.Sb(7,"button",5),y.ac("click",(function(){return y.Ac(n),y.ec().saveAndRunQuery(!0,!1)})),y.Oc(8," Save "),y.Rb(),y.Rb(),y.Sb(9,"div",6),y.Sb(10,"div",7),y.Sb(11,"div"),y.Oc(12,"Parameters"),y.Rb(),y.Sb(13,"div"),y.Sb(14,"button",8),y.ac("click",(function(){return y.Ac(n),y.ec().editPipeline()})),y.Sb(15,"mat-icon"),y.Oc(16,"edit"),y.Rb(),y.Rb(),y.Sb(17,"button",9),y.ac("click",(function(){return y.Ac(n),y.ec().openParamsHelp()})),y.Sb(18,"mat-icon"),y.Oc(19,"info"),y.Rb(),y.Rb(),y.Rb(),y.Rb(),y.Mc(20,rt,2,1,"ul",10),y.Rb(),y.Sb(21,"div",6),y.Sb(22,"div",7),y.Oc(23,"Test Parameters"),y.Rb(),y.Mc(24,ct,2,1,"ul",10),y.Rb(),y.Mc(25,ut,2,1,"ng-container",11),y.fc(26,"async"),y.Mc(27,pt,5,1,"div",12),y.Rb(),y.Rb()}if(2&t){var i=e.ngIf,o=y.ec();y.Ab(20),y.kc("ngIf",null==i.Pipeline.Params?null:i.Pipeline.Params.length),y.Ab(4),y.kc("ngIf",null==i.Pipeline.TestParameters?null:i.Pipeline.TestParameters.length),y.Ab(1),y.kc("ngIf",y.gc(26,4,o.warnings$)),y.Ab(2),y.kc("ngIf",i.Pipeline.Description)}}var ft=function(){function t(t,e){this.context=t,this.visualQueryService=e}return t.prototype.ngOnInit=function(){var t=this;this.pipelineModel$=this.visualQueryService.pipelineModel$,this.warnings$=this.visualQueryService.pipelineModel$.pipe(Object(h.a)((function(e){return function(t,e){var n=[];try{var i=/^\[module:moduleid\]=([0-9]*)$/gim.exec(t.Pipeline.TestParameters)[1],o=e.moduleId.toString();i!==o&&n.push("Your test moduleid ("+i+") is different from the current moduleid ("+o+"). Note that 2sxc 9.33 automatically provides the moduleid - so you usually do not need to set it any more.")}catch(r){}return n}(e,t.context)})))},t.prototype.editPipeline=function(){this.visualQueryService.editPipelineEntity()},t.prototype.openParamsHelp=function(){window.open("https://r.2sxc.org/QueryParams","_blank")},t.prototype.saveAndRunQuery=function(t,e){this.visualQueryService.saveAndRun(t,e)},t.\u0275fac=function(e){return new(e||t)(y.Mb(d.a),y.Mb(V))},t.\u0275cmp=y.Gb({type:t,selectors:[["app-run-explorer"]],decls:2,vars:3,consts:[["class","editor-active-explorer fancy-scrollbar-dark",4,"ngIf"],[1,"editor-active-explorer","fancy-scrollbar-dark"],[1,"wrapper"],[1,"actions"],["mat-raised-button","","color","accent",1,"action",3,"click"],["mat-raised-button","",1,"action",3,"click"],[1,"parameters"],[1,"title"],["mat-icon-button","","matTooltip","Edit parameters",3,"click"],["mat-icon-button","","matTooltip","Query Params Docs",3,"click"],["class","values",4,"ngIf"],[4,"ngIf"],["class","description",4,"ngIf"],[1,"values"],[4,"ngFor","ngForOf"],["class","warnings",4,"ngIf"],[1,"warnings"],[2,"color","red"],[1,"description"]],template:function(t,e){1&t&&(y.Mc(0,dt,28,6,"div",0),y.fc(1,"async")),2&t&&y.kc("ngIf",y.gc(1,1,e.pipelineModel$))},directives:[i.t,o.b,l.a,a.a,i.s],pipes:[i.b],styles:[".wrapper[_ngcontent-%COMP%]{padding:24px}.actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;padding-bottom:32px}.actions[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]:not(:last-of-type){margin-bottom:8px}.description[_ngcontent-%COMP%], .parameters[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]{margin:16px 0}.description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{height:40px;display:flex;align-items:center;justify-content:space-between;font-size:14px}.description[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .parameters[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{-webkit-user-select:none;-moz-user-select:none;user-select:none}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]{margin:0;padding-left:16px}.parameters[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], .warnings[_ngcontent-%COMP%]   .values[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{padding:1px 0}"],changeDetection:0}),t}();function bt(t,e){if(1&t){var n=y.Tb();y.Sb(0,"div",8),y.ac("click",(function(){y.Ac(n);var t=e.$implicit;return y.ec(4).addDataSource(t)})),y.Oc(1),y.Rb()}if(2&t){var i=e.$implicit;y.kc("matTooltip",i.Name),y.Ab(1),y.Qc(" ",i.Name," ")}}function ht(t,e){if(1&t&&(y.Sb(0,"div",6),y.Mc(1,bt,2,2,"div",7),y.Rb()),2&t){var n=y.ec().$implicit;y.Ab(1),y.kc("ngForOf",n.value)}}function gt(t,e){if(1&t){var n=y.Tb();y.Qb(0),y.Sb(1,"div",4),y.ac("click",(function(){y.Ac(n);var t=e.$implicit;return y.ec(2).toggleItem(t.key)})),y.Sb(2,"mat-icon"),y.Oc(3),y.Rb(),y.Sb(4,"span"),y.Oc(5),y.Rb(),y.Rb(),y.Mc(6,ht,2,1,"div",5),y.Pb()}if(2&t){var i=e.$implicit,o=y.ec(2);y.Ab(1),y.kc("matTooltip",i.key),y.Ab(2),y.Pc(o.toggledItems.includes(i.key)?"keyboard_arrow_down":"keyboard_arrow_right"),y.Ab(2),y.Pc(i.key),y.Ab(1),y.kc("ngIf",o.toggledItems.includes(i.key))}}function vt(t,e){if(1&t){var n=y.Tb();y.Sb(0,"div",1),y.Sb(1,"mat-slide-toggle",2),y.ac("change",(function(t){return y.Ac(n),y.ec().toggleDifficulty(t)})),y.Oc(2," Show Advanced "),y.Rb(),y.Mc(3,gt,7,4,"ng-container",3),y.fc(4,"keyvalue"),y.Rb()}if(2&t){var i=e.ngIf;y.Ab(3),y.kc("ngForOf",y.gc(4,1,i))}}var yt=function(){function t(t){this.visualQueryService=t,this.toggledItems=[],this.difficulties={default:100,advanced:200},this.difficulty$=new D.a(this.difficulties.default)}return t.prototype.ngOnInit=function(){this.sorted$=Object(R.a)([this.visualQueryService.dataSources$,this.difficulty$]).pipe(Object(h.a)((function(t){var e=Object(b.f)(t,2),n=e[0];if(null!=n)return function(t,e){var n,i,o=Object(E.a)(t).filter((function(t){return t.Difficulty<=e&&null==t.allowNew}));o.sort((function(t,e){return t.Name.toLocaleLowerCase().localeCompare(e.Name.toLocaleLowerCase())}));var r={};try{for(var a=Object(b.h)(o),c=a.next();!c.done;c=a.next()){var s=c.value,l=s.PrimaryType;r[l]?r[l].push(s):r[l]=[s]}}catch(u){n={error:u}}finally{try{c&&!c.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return r}(n,e[1])})))},t.prototype.ngOnDestroy=function(){this.difficulty$.complete()},t.prototype.toggleDifficulty=function(t){this.difficulty$.next(t.checked?this.difficulties.advanced:this.difficulties.default)},t.prototype.addDataSource=function(t){this.visualQueryService.addDataSource(t)},t.prototype.toggleItem=function(t){!function(t,e){var n=e.indexOf(t);-1===n?e.push(t):e.splice(n,1)}(t,this.toggledItems)},t.\u0275fac=function(e){return new(e||t)(y.Mb(V))},t.\u0275cmp=y.Gb({type:t,selectors:[["app-add-explorer"]],decls:2,vars:3,consts:[["class","editor-active-explorer fancy-scrollbar-dark",4,"ngIf"],[1,"editor-active-explorer","fancy-scrollbar-dark"],["labelPosition","before",3,"change"],[4,"ngFor","ngForOf"],["matTooltipShowDelay","750",1,"collapsible",3,"matTooltip","click"],["class","list",4,"ngIf"],[1,"list"],["class","list-item","matTooltipShowDelay","750",3,"matTooltip","click",4,"ngFor","ngForOf"],["matTooltipShowDelay","750",1,"list-item",3,"matTooltip","click"]],template:function(t,e){1&t&&(y.Mc(0,vt,5,3,"div",0),y.fc(1,"async")),2&t&&y.kc("ngIf",y.gc(1,1,e.sorted$))},directives:[i.t,c.a,i.s,l.a,a.a],pipes:[i.b,i.l],styles:[".mat-slide-toggle[_ngcontent-%COMP%]{margin:6px}.collapsible[_ngcontent-%COMP%]{display:flex;align-items:center;cursor:pointer;overflow:hidden;white-space:nowrap;-webkit-user-select:none;-moz-user-select:none;user-select:none;padding:3px 0}.collapsible[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}.collapsible[_ngcontent-%COMP%]   .mat-icon[_ngcontent-%COMP%]{width:18px;height:18px;font-size:18px}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]{cursor:pointer;padding:4px 0 4px 24px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.list[_ngcontent-%COMP%]   .list-item[_ngcontent-%COMP%]:hover{background-color:#2a2d2e}"],changeDetection:0}),t}(),mt=function(t){return{active:t}},St=[{path:"",component:function(){function t(t,e,n){this.context=t,this.route=e,this.visualQueryService=n,this.explorer={run:"run",add:"add"},this.activeExplorer=this.explorer.run,this.context.init(this.route)}return t.prototype.ngOnInit=function(){this.visualQueryService.init()},t.prototype.toggleExplorer=function(t){this.activeExplorer=this.activeExplorer===t?null:t},t.prototype.openHelp=function(){window.open("https://2sxc.org/help","_blank")},t.\u0275fac=function(e){return new(e||t)(y.Mb(d.a),y.Mb(P.a),y.Mb(V))},t.\u0275cmp=y.Gb({type:t,selectors:[["app-visual-query"]],viewQuery:function(t,e){var n;1&t&&y.Tc(it,!0),2&t&&y.xc(n=y.bc())&&(e.plumbEditor=n.first)},features:[y.zb([V])],decls:16,vars:8,consts:[[1,"editor-root"],[1,"editor-side-toolbar"],["matTooltip","Run",1,"button",3,"ngClass","click"],["matTooltip","Add",1,"button",3,"ngClass","click"],[1,"spacer"],["matTooltip","Help",1,"button",3,"click"],[3,"hidden"]],template:function(t,e){1&t&&(y.Nb(0,"router-outlet"),y.Sb(1,"div",0),y.Sb(2,"div",1),y.Sb(3,"div",2),y.ac("click",(function(){return e.toggleExplorer(e.explorer.run)})),y.Sb(4,"mat-icon"),y.Oc(5,"play_arrow"),y.Rb(),y.Rb(),y.Sb(6,"div",3),y.ac("click",(function(){return e.toggleExplorer(e.explorer.add)})),y.Sb(7,"mat-icon"),y.Oc(8,"add"),y.Rb(),y.Rb(),y.Nb(9,"div",4),y.Sb(10,"div",5),y.ac("click",(function(){return e.openHelp()})),y.Sb(11,"mat-icon"),y.Oc(12,"help_outline"),y.Rb(),y.Rb(),y.Rb(),y.Nb(13,"app-run-explorer",6),y.Nb(14,"app-add-explorer",6),y.Nb(15,"app-plumb-editor"),y.Rb()),2&t&&(y.Ab(3),y.kc("ngClass",y.oc(4,mt,e.activeExplorer===e.explorer.run)),y.Ab(3),y.kc("ngClass",y.oc(6,mt,e.activeExplorer===e.explorer.add)),y.Ab(7),y.kc("hidden",e.activeExplorer!==e.explorer.run),y.Ab(1),y.kc("hidden",e.activeExplorer!==e.explorer.add))},directives:[P.e,l.a,i.q,a.a,ft,yt,it],styles:[".editor-side-toolbar[_ngcontent-%COMP%]{display:flex;flex-direction:column}.editor-side-toolbar[_ngcontent-%COMP%]   .spacer[_ngcontent-%COMP%]{flex-grow:1}"],changeDetection:0}),t}(),children:[{matcher:C.a,loadChildren:function(){return Promise.all([n.e(1),n.e(2),n.e(4),n.e(3),n.e(6),n.e(9),n.e(11),n.e(15),n.e(14),n.e(13),n.e(0),n.e(35)]).then(n.bind(null,"B+J5")).then((function(t){return t.EditModule}))},data:{history:!1}}]}],Ot=function(){function t(){}return t.\u0275mod=y.Kb({type:t}),t.\u0275inj=y.Jb({factory:function(e){return new(e||t)},imports:[[P.d.forChild(St)],P.d]}),t}(),Pt=function(){function t(){}return t.\u0275mod=y.Kb({type:t}),t.\u0275inj=y.Jb({factory:function(e){return new(e||t)},providers:[d.a,O,p.a,u.a],imports:[[i.c,f.a,Ot,a.b,l.b,o.c,c.b,s.c,r.f]]}),t}()},"YW/4":function(t,e,n){"use strict";function i(t){return new Promise((function(e,n){var i=new FileReader;i.readAsDataURL(t),i.onload=function(){e(i.result.split(",")[1])},i.onerror=function(t){n(t)}}))}function o(t){return new Promise((function(e,n){var i=new FileReader;i.readAsText(t),i.onload=function(){e(i.result)},i.onerror=function(t){n(t)}}))}n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return o}))},geKs:function(t,e,n){"use strict";n.d(e,"f",(function(){return i.d})),n.d(e,"d",(function(){return i.b})),n.d(e,"e",(function(){return i.c})),n.d(e,"a",(function(){return o.a})),n.d(e,"h",(function(){return r.c})),n.d(e,"g",(function(){return r.b})),n.d(e,"b",(function(){return r.a})),n.d(e,"c",(function(){return a.a}));var i=n("6fnQ"),o=(n("iKpp"),n("kfUh"),n("JXuk")),r=(n("0adC"),n("b67o")),a=(n("IMfk"),n("2FQU"));n("39Ct"),n("gatd"),n("Scw0")}}]);
//# sourceMappingURL=https://sources.2sxc.org/11.11.04/ng-edit/visual-query-visual-query-module.609df237e3bed254a98d.js.map