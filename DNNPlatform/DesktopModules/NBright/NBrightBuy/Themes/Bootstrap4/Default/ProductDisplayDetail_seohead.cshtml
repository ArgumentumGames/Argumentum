@inherits NBrightBuy.render.NBrightBuyRazorTokens<NBrightRazor>
@using System.Linq
@using DotNetNuke.Entities.Users
@using NBrightDNN
@using Nevoweb.DNN.NBrightBuy.Components;

@AddMetaData("resourcepath", "/DesktopModules/NBright/NBrightBuy/App_LocalResources/")

@{
    // assign Model, so we can resolve var in VS
    var product = (ProductData)Model.List.First();
    var info = (NBrightInfo)product.Info;
    var brand = PropertyValue(product, "man", "propertyname").ToString();
    if (brand == "")
    {
        brand = info.GetXmlProperty("genxml/textbox/manufacturer");
    }

    var imgurl = "";
    if (product.Imgs.Count > 1)
    {
        imgurl = product.Imgs.First().GetXmlProperty("genxml/hidden/imageurl");
    }

}

<!-- JSON-LD markup generated by Google's structured data markup help tool -->
<script type="application/ld+json">
{
  "@@context" : "http://schema.org",
  "@@type" : "Product",
  "name" : "@(product.ProductName)",
  "image" : "http://@WebsiteUrl()@(imgurl)",
  "description" : "@BreakOf(info, "genxml/lang/genxml/textbox/txtsummary")",
  "url" : "@EntryUrl(info,Model,false,product.SEOName)",
  "brand" : {
    "@@type" : "Brand",
    "name" : "@(brand)"
  },
  "offers" : {
    "@@type" : "Offer",
    "price" : "@(NBrightBuyUtils.FormatToStoreCurrency(product.BestPrice()))"
  }
}
</script>

<!-- Facebook id number for Page Insights - https://www.facebook.com/help/336893449723054 -->
<meta property="fb:app_id" content="@Model.GetSetting("facebookid")"/>

<!-- Open Graph data for Facebook - https://developers.facebook.com/docs/reference/opengraph/object-type/product/ -->
<meta property="og:type" content="product.item" />
<meta property="og:title" content="@(product.ProductName)" />
<meta property="og:description" content="@BreakOf(info, "genxml/lang/genxml/textbox/txtsummary")" />
<meta property="og:image" content="http://@WebsiteUrl()@(imgurl)" />
<meta property="og:url" content="@EntryUrl(info,Model,false,product.SEOName)" />
<meta property="og:site_name" content="@Model.GetSetting("portalname")" />
<meta property="product:price:amount" content="@product.FromPrice()">
<meta property="product:price:currency" content="@(NBrightBuyUtils.GetCurrencyIsoCode())">

<!-- Twitter Card - https://dev.twitter.com/docs/cards -->
<meta name="twitter:title" content="@(product.ProductName)" />
<meta name="twitter:card" content="product" />
<meta name="twitter:site" content="@Model.GetSetting("twittersite")" />
<meta name="twitter:creator" content="@Model.GetSetting("twitteruser")" />
<meta name="twitter:domain" content="@WebsiteUrl()" />
<meta name="twitter:description" content="@BreakOf(info, "genxml/lang/genxml/textbox/txtsummary")" />
<meta name="twitter:image" content="http://@WebsiteUrl()@(imgurl)" />

