{"version":3,"sources":["webpack://mobiusforms/webpack/bootstrap","webpack://mobiusforms/./src/ts/add-ins/uiActions.ts","webpack://mobiusforms/./src/ts/main.ts","webpack://mobiusforms/./src/ts/collect-fields/manual.ts","webpack://mobiusforms/./src/ts/collect-fields/auto.ts","webpack://mobiusforms/./src/ts/add-ins/recaptcha.ts"],"names":["enumerable","get","getter","value","key","bind","module","Object","prototype","hasOwnProperty","call","object","property","showOneAlert","wrapper","showId","find","hide","show","disableInputs","state","toggleClass","prop","attachFieldValidateOnBlur","$","this","data","smkValidate","UiActions","moduleId","helperFunc","collectFieldsManual","CollectFieldsManual","collectFieldsAutomatic","CollectFieldsAutomatic","recaptcha","Recaptcha","alreadyInit","c","clsWrp","clsForm","attr","moduleWrapper","initialize","on","each","i","item","evt","send","event","btn","currentTarget","sxc","$2sxc","label","text","trackingEvent","CustomEvent","detail","category","action","document","dispatchEvent","recap","check","mailchimp","hasClass","collect","then","ws","MailChimp","webApi","post","success","msg","error","App","Subject","Message","SenderName","SenderMail","val","Files","promises","not","map","field","element","propName","toLowerCase","Deferred","files","FileReader","addEventListener","push","Encoded","result","Name","name","Field","resolve","readAsDataURL","promise","is","checkValue","add","when","apply","recapId","clsRecap","init","isNaN","id","grecaptcha","render","length","getResponse"],"mappings":"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","file":"app-bundle.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","// rename to UiActions\r\nexport class UiActions {\r\n  showOneAlert(wrapper: JQuery, showId: string) {\r\n    wrapper.find('.alert').hide();\r\n    if (showId !== '') {\r\n      wrapper.find('#' + showId).show();\r\n    }\r\n  }\r\n\r\n  disableInputs(wrapper: JQuery, state: boolean) {\r\n    wrapper.toggleClass('disable', state)\r\n    wrapper.find(':input').prop('disabled', state);\r\n  }\r\n\r\n  attachFieldValidateOnBlur() {\r\n    // skif if validation is already enabled\r\n    if ($(this).data('alreadyRun')) return;\r\n\r\n    // not yet enabled, let's enable and remember...\r\n    ($(this) as any).smkValidate();\r\n    $(this).data('alreadyRun', true);\r\n  }\r\n}","declare let $2sxc: any;\r\n\r\nimport { UiActions } from './add-ins/uiActions';\r\nimport { CollectFieldsManual } from './collect-fields/manual';\r\nimport { CollectFieldsAutomatic } from './collect-fields/auto';\r\nimport { Recaptcha } from './add-ins/recaptcha';\r\nexport class App {\r\n  helperFunc = new UiActions();\r\n  collectFieldsManual = new CollectFieldsManual();\r\n  collectFieldsAutomatic = new CollectFieldsAutomatic();\r\n  recaptcha = new Recaptcha();\r\n  moduleWrapper: JQuery;\r\n  alreadyInit = false;\r\n\r\n  c = {\r\n    clsWrp: 'mobius-wrapper',\r\n    clsForm: 'mobius-form',\r\n  };\r\n\r\n  constructor(\r\n    moduleId: number,\r\n  ) {\r\n    // disable validate on the global asp.net form, to not interfere with the contact-form\r\n    $('form').attr('novalidate', '');\r\n    this.moduleWrapper = $(`.DnnModule-${moduleId}`);\r\n  }\r\n\r\n  public initialize() {\r\n    const wrapper = this.moduleWrapper;\r\n    // attach validation to enable as soon as we blur        \r\n    wrapper.on('blur', ':input', this.helperFunc.attachFieldValidateOnBlur);\r\n\r\n    wrapper.each((i, item) => {\r\n      // prevent dupl execution\r\n      if (this.alreadyInit)\r\n        return;\r\n\r\n      const wrap = $(item);\r\n      wrap.find('#sendFormWithApi').on('click', (evt: JQueryEventObject) => this.send(evt)); // handle click event\r\n\r\n      this.alreadyInit = true;\r\n    });\r\n  }\r\n\r\n  public send(event: JQueryEventObject) {\r\n    const btn = event.currentTarget;\r\n    const sxc = $2sxc(btn);\r\n    const wrapper = this.moduleWrapper;\r\n    const label = wrapper.find('#sendFormWithApi').text();\r\n\r\n    // clear all alerts\r\n    this.helperFunc.showOneAlert(wrapper, '');\r\n\r\n    const trackingEvent = new CustomEvent('trackMobiusForm', { detail: { category: 'mobius-form', action: 'submit', label: label } });\r\n    document.dispatchEvent(trackingEvent);\r\n\r\n    // Validate form\r\n    if (!(wrapper as any).smkValidate())\r\n      return this.helperFunc.showOneAlert(wrapper, 'msgIncomplete');\r\n\r\n    // Do Recaptcha test, show alert & fail if required and not complete\r\n    const recap = this.recaptcha.check(wrapper);\r\n    if (!recap)\r\n      return this.helperFunc.showOneAlert(wrapper, 'msgRecap');\r\n\r\n    const mailchimp = wrapper.find('.mobius-wrapper').hasClass('mobius-mailchimp');\r\n\r\n    // get data \r\n    // alternative example with manual build, but we prefer automatic\r\n    // let data;\r\n    // data = this.collectFieldsManual.collect(wrapper);\r\n    this.collectFieldsAutomatic.collect(wrapper).then((data: any) => {\r\n      const ws = wrapper.find('.mobius-wrapper').data('webservice'); // should be \"Form/ProcessForm\" or a custom override\r\n      data.Recaptcha = recap;\r\n      data.MailChimp = mailchimp;\r\n      // submission\r\n      this.helperFunc.disableInputs(wrapper, true);\r\n      this.helperFunc.showOneAlert(wrapper, 'msgSending'); // show \"sending...\"\r\n\r\n      sxc.webApi.post(ws, null, data, true)\r\n        .success(() => {\r\n          const msg = mailchimp ? 'msgNewsletterSuccess' : 'msgOk';\r\n          this.helperFunc.showOneAlert(wrapper, msg);\r\n\r\n          const trackingEvent = new CustomEvent('trackMobiusForm', { detail: { category: 'mobius-form', action: 'success', label: label } });\r\n          document.dispatchEvent(trackingEvent);\r\n        })\r\n        .error(() => {\r\n          const msg = mailchimp ? 'msgNewsletterFailed' : 'msgError';\r\n          this.helperFunc.showOneAlert(wrapper, msg);\r\n          this.helperFunc.disableInputs(wrapper, false);\r\n\r\n          const trackingEvent = new CustomEvent('trackMobiusForm', { detail: { category: 'mobius-form', action: 'error', label: label } });\r\n          document.dispatchEvent(trackingEvent);\r\n        });\r\n    });\r\n  }\r\n}","/*\r\n  This is an example of collecting the fields manually (instead of automatically). \r\n  You would modify this file list all the fields you want, which allows you to use\r\n  a different naming schema than the default. \r\n  This is an advanced use case, and included so you could do this, but you usually won't want to.\r\n*/\r\nexport class CollectFieldsManual {\r\n  // automatically build the send-object with all properties, \r\n  // based on all form-fields which have a item-property=\"\"\r\n  collect(wrapper: JQuery) {\r\n    const data: any = {\r\n      Subject: wrapper.find('#Subject'),\r\n      Message: wrapper.find('#Message'),\r\n      SenderName: wrapper.find('#Sendername'),\r\n      SenderMail: wrapper.find('#Sendermail')\r\n    };\r\n\r\n    for (let prop in data) {\r\n      if (data.hasOwnProperty(prop)) {\r\n        data[prop] = data[prop].val();\r\n      }\r\n    }\r\n\r\n    return data;\r\n  }\r\n}","export class CollectFieldsAutomatic {\r\n  // automatically build the send-object with all properties, \r\n  // based on all form-fields which have a item-property=\"\"\r\n  collect(wrapper: JQuery) {\r\n    let data: any = {\r\n      Files: []\r\n    };\r\n    const fields = wrapper.find(':input').not('button');\r\n    const promises = fields.map((i, field) => add(i, field));\r\n    \r\n    function add(i: number, element: any) {\r\n      element = $(element);\r\n      // get the property name from special-attribut, name OR id\r\n      const propName = element.attr('name') || element.attr('id');\r\n\r\n      if (!propName)\r\n        return;\r\n\r\n      // extract data from file fields\r\n      if (element.attr('type') && element.attr('type').toLowerCase() == 'file') {\r\n        const deferred = $.Deferred();\r\n        const file = element.get(0).files[0];\r\n        if (!file)\r\n          return;\r\n\r\n        const reader = new FileReader();\r\n\r\n        reader.addEventListener('load', function () {\r\n          data.Files.push({\r\n            Encoded: reader.result,\r\n            Name: file.name,\r\n            Field: propName\r\n          });\r\n          deferred.resolve();\r\n        }, false);\r\n        reader.readAsDataURL(file);\r\n\r\n        return deferred.promise();\r\n\r\n      } else if (element.attr('type') && element.attr('type').toLowerCase() == 'radio') { // For radio fields get checked values\r\n        if (element.is(':checked')) {\r\n          data[propName] = element.val();\r\n        }\r\n      } else if (element.attr('type') && element.attr('type').toLowerCase() == 'checkbox') { // For radio fields get checked values\r\n        const checkValue = element.is(':checked') ? \"True\" : \"False\";\r\n        data[propName] = checkValue;\r\n      } else { // For all standard fields, set value directly\r\n        data[propName] = element.val();\r\n      }\r\n    }\r\n\r\n    return $.when.apply($, promises).then(() => {\r\n      return data;\r\n    });\r\n  }\r\n}","declare let grecaptcha: any;\r\n\r\nimport { UiActions } from './uiActions';\r\n\r\nexport class Recaptcha {\r\n  helperFunc = new UiActions();\r\n\r\n  c  = {\r\n    recapId: \"recapId\",\r\n    clsRecap: \"g-recaptcha\"\r\n  };\r\n\r\n  constructor() { }\r\n\r\n  /*\r\n    Initialize Recaptcha and create a Recapcha Checkbox below the Formfields \r\n  */\r\n  init(wrapper: JQuery) {\r\n    const recap = wrapper.find(this.c.clsRecap);\r\n\r\n    if(!isNaN(wrapper.data(this.c.recapId))) {\r\n        return;\r\n    }\r\n\r\n    const id = grecaptcha.render(recap, {\r\n      'sitekey' : recap.data(\"sitekey\"),\r\n      'size' : 'normal'\r\n    });\r\n\r\n    wrapper.data(this.c.recapId, id); // remember for later use       \r\n  }\r\n\r\n\r\n  \r\n  /* \r\n    Checks if a recaptcha is implemented in the current Form\r\n  */\r\n  check(wrapper: JQuery) {\r\n    const recap = wrapper.find(\".\" + this.c.clsRecap);\r\n    // if no recaptcha found, probably ok\r\n    if(recap.length === 0) {\r\n      return true;\r\n    }\r\n\r\n    // if many found, probably not ok\r\n    if(recap.length !== 1) {\r\n      throw \"recaptcha not found\";\r\n    }\r\n\r\n    // return google response for the recap\r\n    const res = grecaptcha.getResponse(); // null if failed, something cryptic if ok\r\n\r\n    return res || false; \r\n  }\r\n}"],"sourceRoot":""}